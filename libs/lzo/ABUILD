#ABUILD created by: SirAnthony, anthony at adsorbtion.org 
pkgname=lzo
pkgver=2.10
pkgbuild=1
arch=('auto')

shortdesc="Portable lossless data compression library"
source=("https://www.oberhumer.com/opensource/lzo/download/lzo-${pkgver}.tar.gz")
tags="dev-libs libs"

build_deps="gcc"

build() {
  go_src_dir
  ./configure --prefix=/usr --enable-shared --sysconfdir=/etc --libdir=/usr/lib${LIBDIRSUFFIX} --docdir=/usr/share/doc/${pkgname}-${pkgver} --mandir=/usr/share/man
  make

  # build minilzo
  gcc $CPPFLAGS $CFLAGS -fpic -Iinclude/lzo -o minilzo/minilzo.o -c minilzo/minilzo.c
  gcc $LDFLAGS -shared -o libminilzo.so.0 -Wl,-soname,libminilzo.so.0 minilzo/minilzo.o
}

after_build(){
    go_src_dir

    make DESTDIR=${pkgdir} install

    # install minilzo
    install -m 755 libminilzo.so.0 ${pkgdir}/usr/lib${LIBDIRSUFFIX}
    install -p -m 644 minilzo/minilzo.h ${pkgdir}/usr/include/lzo
    cd ${pkgdir}/usr/lib${LIBDIRSUFFIX}
    ln -s libminilzo.so.0 libminilzo.so
}
