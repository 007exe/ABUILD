pkgname=xmlrpc-c
pkgver=1.51.07
pkgbuild=1
arch=('auto')

shortdesc=("Programming library for writing an XML-RPC server or client in C or C++")
longdesc=("XML-RPC is a quick-and-easy way to make procedure calls over the Internet. It converts the procedure call into XML document, sends it to a remote server using HTTP, and gets back the response as XML.")

source=("https://sourceforge.net/projects/xmlrpc-c/files/Xmlrpc-c%20Super%20Stable/$pkgver/xmlrpc-c-$pkgver.tgz")

tags="libs dev-libs"
# setconf
build_deps="curl libtool"

build() {
  go_src_dir
  burn_patches
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --mandir=/usr/share/man \
    --disable-libxml2-backend \
    --disable-cgi-server \
    --disable-libwww-client \
    --disable-wininet-client \
    --disable-static \
    --enable-cplusplus
  mkdir -p include/curl
  touch include/curl/types.h
  make CFLAGS_PERSONAL="$CFLAGS -fPIC -w" CXXFLAGS_PERSONAL="$CXXFLAGS -fPIC -w"
  make -C tools CFLAGS_PERSONAL="$CFLAGS -fPIC -w" CXXFLAGS_PERSONAL="$CXXFLAGS -fPIC -w"
  make DESTDIR=${pkgdir} install
  make DESTDIR=${pkgdir} -C tools install

# Remove references to build directory
#  setconf "$pkgdir/usr/bin/xmlrpc-c-config" BLDDIR ''
#  setconf "$pkgdir/usr/bin/xmlrpc-c-config" ABS_SRCDIR ''

# Custom license
  install -Dm644 doc/COPYING "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
