pkgname=libpng
pkgver=1.6.37
_apngver=${pkgver}
pkgbuild=1
arch=('auto')

shortdesc="libpng (Portable Network Graphics library)"

source=("https://downloads.sourceforge.net/libpng/libpng-${pkgver}.tar.xz"
"https://downloads.sourceforge.net/sourceforge/libpng-apng/libpng-$_apngver-apng.patch.gz")

tags="media-libs libs"

build_deps="zlib"

before_build() {
        go_src_dir
	# Add animated PNG (apng) support
	# We need to patch the patch
	cp ${srcache}/libpng-${_apngver}-apng.patch.gz .
	gzip -cd libpng-${_apngver}-apng.patch.gz | patch -p1
}

build() {
	go_src_dir
	./configure \
	--prefix=/usr \
	--libdir=/usr/lib${LIBDIRSUFFIX} \
	--mandir=/usr/share/man \
	--docdir=/usr/share/doc/${pkgname}-${pkgver}
	make
}

after_build() {
	go_src_dir
	make DESTDIR="$pkgdir" install
	cd contrib/pngminus
	make PNGLIB_SHARED="-L$pkgdir/usr/lib${LIBDIRSUFFIX} -lpng" CFLAGS="$CFLAGS" LDFLAGS="$LDFLAGS" png2pnm pnm2png
	install -m0755 png2pnm pnm2png "$pkgdir/usr/bin/"
}
