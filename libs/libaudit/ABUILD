pkgname=libaudit
pkgver=3.0.4
pkgbuild=1
arch=("auto")

shortdesc=("The audit-libs package contains the dynamic libraries needed for applications to use the audit framework.")
longdesc=("The audit package contains the user space utilities for storing and searching the audit records generate by the audit subsystem in the Linux 2.6 kernel.")

tags=("libs sys-libs")

source="http://people.redhat.com/sgrubb/audit/audit-${pkgver}.tar.gz"

build_deps="libcap-ng openldap kernel-headers python krb5 swig"

config_files="etc/libaudit.conf
etc/audit/audit-stop.rules
etc/audit/auditd.conf
etc/audit/audisp-remote.conf
etc/audit/zos-remote.conf
etc/audit/plugins.d/af_unix.conf
etc/audit/plugins.d/au-remote.conf
etc/audit/plugins.d/audispd-zos-remote.conf
etc/audit/plugins.d/syslog.conf"

build() {
  go_src_dir
  burn_patches
  ./configure \
    --libdir=/lib${LIBDIRSUFFIX} \
    --prefix=/usr \
    --bindir=/bin \
    --sbindir=/bin \
    --sysconfdir=/etc \
    --with-python=yes \
    --enable-gssapi-krb5=yes \
    --with-libcap-ng=yes
  make -j${numjobs}
  [ -n "${SOURCE_DATE_EPOCH}" ] && touch -h -d @$SOURCE_DATE_EPOCH bindings/swig/python/audit.py
  make DESTDIR="${pkgdir}" INSTALL='install -p' install
}

after_build() {
  install -d ${pkgdir}/var/log/audit
  rm -rf ${pkgdir}/etc/rc.d
  rm -rf ${pkgdir}/etc/sysconfig
}
