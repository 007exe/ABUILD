pkgname=libwebp
pkgver=1.2.0
pkgbuild=1
arch=('auto')

shortdesc=("Library and tools for the WebP graphics format")
longdesc=("WebP is an image format that does lossy compression of digital photographic images. WebP consists of a codec based on VP8, and a container based on RIFF. Webmasters, web developers and browser developers can use WebP to compress, archive and distribute digital images more efficiently.")

source=("https://chromium.googlesource.com/webm/libwebp/+archive/${pkgver}.tar.gz")

tags="media-libs libs"

build_deps="libpng"

build() {
  go_src_dir
  cd ..
  burn_patches
  NOCONFIGURE=1 ./autogen.sh
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --disable-static \
    --enable-swap-16bit-csp \
    --enable-experimental \
    --enable-libwebp{mux,demux,decoder,extras}
  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
  make -j${numjobs}
  make DESTDIR=${pkgdir} install
  install -Dm644 COPYING "$pkgdir/usr/share/licenses/$pkgname/COPYING"
}
