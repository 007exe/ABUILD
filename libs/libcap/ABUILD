# ABUILD generated by mkpkg_generator.sh

pkgname=libcap
pkgver=2.43
pkgbuild=1
arch=("auto")

shortdesc=("libcap (get/set POSIX capabilities)")
longdesc=("This is a library for getting and setting POSIX.1e (formerly POSIX 6) draft 15 capabilities. Libcap was written by Andrew G. Morgan; however, it would not have been possible without the help of Aleph1, Roland Buresund, Andrew Main, and Alexander Kjeldaas.")

tags=("libs sys-libs compat32")

# kernel.org still misses these files, so use archlinux mirror
source=("https://mirrors.edge.kernel.org/pub/linux/libs/security/linux-privs/libcap2/${pkgname}-${pkgver}.tar.gz")

build_deps="attr libnl"

build() {
	go_src_dir
	burn_patches

	# Set CFLAGS
	sed -i.orig "s/^\(DEBUG =\).*/\1$SLKCFLAGS/" Make.Rules

	make DYNAMIC=yes -j${numjobs}
	make man_prefix=/usr DESTDIR=${pkgdir} RAISE_SETFCAP=no install
	chmod 755 ${pkgdir}/lib${LIBDIRSUFFIX}/libcap.so.*
	rm ${pkgdir}/lib${LIBDIRSUFFIX}/libcap.a

	install -Dm0644 pam_cap/capability.conf ${pkgdir}/usr/doc/${pkgname}-${pkgver}/capability.conf.example

	# Add included scripts
	( cd contrib
		for file in pcaps4convenience pcaps4server pcaps4suid0 ; do
			install -m 0755 -D $file ${pkgdir}/usr/sbin/$file
		done
	)

	# glibc already has the capget/capset manpage
	rm -rf ${pkgdir}/usr/man/man2
}
