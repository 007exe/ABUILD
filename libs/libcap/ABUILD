pkgname=libcap
pkgver=2.49
pkgbuild=1
arch=("auto")

shortdesc="POSIX 1003.1e capabilities"
longdesc="This is a library for getting and setting POSIX.1e (formerly POSIX 6) draft 15 capabilities. Libcap was written by Andrew G. Morgan; however, it would not have been possible without the help of Aleph1, Roland Buresund, Andrew Main, and Alexander Kjeldaas."

tags=("libs sys-libs compat32")

source=("https://mirrors.edge.kernel.org/pub/linux/libs/security/linux-privs/libcap2/${pkgname}-${pkgver}.tar.gz")

build_deps="attr libnl"

build() {
  go_src_dir
  burn_patches

# Prevent installation of static library
  sed -i '/install.*STALIBNAME/d' libcap/Makefile

  make KERNEL_HEADERS='/usr/include' lib=lib${LIBDIRSUFFIX} prefix='/usr'
  make DESTDIR=${pkgdir} RAISE_SETFCAP='no' lib=lib${LIBDIRSUFFIX} prefix='/usr' install

  install -vDm 644 {CHANGELOG,README} -t "${pkgdir}/usr/share/doc/${pkgname}/"
  install -vDm 644 pam_cap/capability.conf -t "$pkgdir/usr/share/doc/$pkgname/examples/"
}
