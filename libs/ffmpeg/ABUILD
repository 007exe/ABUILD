pkgname=ffmpeg
pkgver=4.4
pkgbuild=1
arch="auto"

shortdesc=("Complete solution to record, convert and stream audio and video")
longdesc=("ffmpeg is a hyper fast realtime audio/video encoder, a streaming server and a generic audio and video file converter.")

source=("http://ffmpeg.org/releases/${pkgname}-${pkgver}.tar.xz")

tags="libs media-video"

# avisynthplus --enable-avisynth
# aom          --enable-libaom
# dav1d        --enable-libdav1d
# libmfx       --enable-libmfx
# libpulse     --enable-libpulse (Требуется pulseaudio)
# rav1e        --enable-librav1e
# librsvg      --enable-librsvg
# libsoxr      --enable-libsoxr
# svt-av1      --enable-libsvtav1
# v4l-utils    --enable-libv4l2
# vmaf         --enable-libvmaf
# libvpx       --enable-libvpx
# jack         --enable-libjack
# amf-headers  --enable-amf
#              --enable-nvdec
#              --enable-nvenc
#              --enable-libxvid
#              --enable-libzimg
#              --enable-libvidstab
# sdl2

# ffnvcodec-headers
build_deps=("fontconfig fribidi libraw1394 libssh libxml2 libwebp alsa-lib xz bzip2 zlib nasm yasm gmp gnutls ladspa libass libbluray libdrm gsm libmodplug lame opencore-amr openjpeg2 opus speex x264 x265 xvidcore clang libavc1394 libtheora srt libiec61883 libvdpau libx11 libxext libxv libxcb")

build(){
  go_src_dir
  burn_patches
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --disable-debug \
    --disable-static \
    --disable-stripping \
    --enable-libiec61883 \
    --enable-libxcb \
    --enable-libsrt \
    --enable-cuda-llvm \
    --enable-lto \
    --enable-fontconfig \
    --enable-gmp \
    --enable-gnutls \
    --enable-gpl \
    --enable-ladspa \
    --enable-libbluray \
    --enable-libdrm \
    --enable-libgsm \
    --enable-libfreetype \
    --enable-libfribidi \
    --enable-libmodplug \
    --enable-libmp3lame \
    --enable-libopencore_amrnb \
    --enable-libopencore_amrwb \
    --enable-libopenjpeg \
    --enable-libass \
    --enable-libspeex \
    --enable-libssh \
    --enable-libtheora \
    --enable-libopus \
    --enable-libvorbis \
    --enable-libwebp \
    --enable-libx264 \
    --enable-libx265 \
    --enable-libxml2 \
    --enable-shared \
    --enable-version3
  make -j${numjobs}
  make tools/qt-faststart -j${numjobs}
  make doc/ff{mpeg,play}.1
  make DESTDIR="${pkgdir}" install install-man
#  install -Dm 755 ffmpeg/tools/qt-faststart "${pkgdir}"/usr/bin/
}
