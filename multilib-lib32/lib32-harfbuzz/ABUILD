pkgname=lib32-harfbuzz
pkgver=5.3.1
pkgbuild=1
arch=("auto")

shortdesc=("OpenType text shaping engine (32-bit).")
longdesc=("The HarfBuzz package contains an OpenType text shaping engine.")

source=("https://github.com/harfbuzz/harfbuzz/releases/download/${pkgver}/harfbuzz-${pkgver}.tar.xz")

tags=("lib32 media-libs")

build_deps=("lib32-glib2 lib32-icu ragel python meson harfbuzz lib32-freetype")

adddep=("lib32-glibc lib32-glib2 lib32-freetype harfbuzz")

build() {
  go_src_dir
  burn_patches
  export CC="gcc -m32"
  export CXX="gcc -m32"
  export PKG_CONFIG_PATH="/usr/lib32/pkgconfig"
  CFLAGS="${CFLAGS/-fexceptions/}"
  CXXFLAGS="${CXXFLAGS/-fexceptions/}"
  meson build \
    -D prefix=/usr \
    -D libdir=/usr/lib32 \
    -D cairo=disabled \
    -D coretext=disabled \
    -D chafa=disabled \
    -D introspection=disabled \
    -D docs=disabled \
    -D tests=disabled
  meson compile -C build
  meson install -C build --destdir ${pkgdir}
  install -Dt ${pkgdir}/usr/share/licenses/${pkgname} -m644 COPYING
  rm -r ${pkgdir}/usr/{bin,include}
}
