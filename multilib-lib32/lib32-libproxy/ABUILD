pkgname=lib32-libproxy
pkgver=0.4.18
pkgbuild=1
arch=("auto")

shortdesc=("Automatic proxy configuration management library (32-bit).")

source=("https://github.com/libproxy/libproxy/releases/download/${pkgver}/libproxy-${pkgver}.tar.xz")

tags=("lib32 net-libs")

adddep=("lib32-dbus lib32-gcc-libs lib32-glib2 lib32-zlib libproxy")

build_deps=("${adddep} cmake ninja")

build() {
  go_src_dir
  burn_patches
  export CC='gcc -m32'
  export CXX='g++ -m32'
  export PKG_CONFIG=i686-pc-linux-gnu-pkg-config
  cmake -B build -G Ninja \
    -DBIPR=1 \
    -DCMAKE_BUILD_TYPE=None \
    -DCMAKE_CXX_FLAGS="$CXXFLAGS" \
    -DCMAKE_C_FLAGS="$CFLAGS" \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_SKIP_RPATH=ON \
    -DLIB_SUFFIX=32 \
    -DWITH_DUKTAPE=OFF \
    -DWITH_PERL=OFF \
    -DWITH_WEBKIT=OFF
  cmake --build build
  DESTDIR=${pkgdir} cmake --install build
  rm -r ${pkgdir}/usr/{bin,include,lib,share}
}
