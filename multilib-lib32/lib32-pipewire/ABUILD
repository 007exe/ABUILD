pkgname=lib32-pipewire
pkgver=0.3.60
pkgbuild=1
arch=("auto")

shortdesc=("Low-latency audio/video router and processor (32-bit).")
longdesc=("The pipewire package contains a server and user-space API to handle multimedia pipelines.")

source=("https://github.com/PipeWire/pipewire/archive/${pkgver}/pipewire-${pkgver}.tar.gz")

tags=("lib32 media-libs")

build_deps=("lib32-alsa-lib lib32-dbus lib32-glib2 meson")

adddep=("pipewire")

build() {
  go_src_dir
  burn_patches
  export CC="gcc -m32"
  export CXX="g++ -m32"
  export PKG_CONFIG="i686-pc-linux-gnu-pkg-config"
  meson build \
    -D prefix=/usr \
    --libdir /usr/lib32 \
    -D avahi=disabled \
    -D avb=disabled \
    -D bluez5-codec-lc3plus=disabled \
    -D bluez5-codec-opus=disabled \
    -D bluez5=disabled \
    -D echo-cancel-webrtc=disabled \
    -D examples=disabled \
    -D gstreamer-device-provider=disabled \
    -D gstreamer=disabled \
    -D jack-devel=true \
    -D jack=disabled \
    -D libcamera=disabled \
    -D libcanberra=disabled \
    -D libjack-path=/usr/lib32 \
    -D libpulse=disabled \
    -D libusb=disabled \
    -D lv2=disabled \
    -D man=disabled \
    -D pw-cat=disabled \
    -D raop=disabled \
    -D readline=disabled \
    -D roc=disabled \
    -D sdl2=disabled \
    -D session-managers=[] \
    -D sndfile=disabled \
    -D systemd-user-service=disabled \
    -D tests=disabled \
    -D udevrulesdir=/usr/lib/udev/rules.d \
    -D v4l2=disabled \
    -D x11-xfixes=disabled \
    -D x11=disabled
  meson compile -C build
  meson install -C build --destdir ${pkgdir}

  rm -r ${pkgdir}/usr/{bin,include,lib,share}

  install -Dt ${pkgdir}/usr/share/licenses/${pkgname} -m644 pipewire/COPYING
}
