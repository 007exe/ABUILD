# ABUILD generated by mkpkg_generator.sh

pkgname=mlocate
pkgver=0.26
pkgbuild=2
arch=("auto")

shortdesc=("Merging locate/updatedb implementation")
tags=("base sys-apps")
source=("https://fedorahosted.org/releases/m/l/mlocate/mlocate-${pkgver}.tar.xz")
build_deps="gcc"
conflicts="slocate"

BUILD_SYSTEM="autotools"
BUILD_KEYS="--prefix=/usr --libdir=/usr/lib$LIBDIRSUFFIX --mandir=/usr/man --sysconfdir=/etc --localstatedir=/var/lib"
MAKE_KEYS="groupname=locate"
INSTALL_KEYS="DESTDIR=$pkgdir"

after_build() {
  go_src_dir
  make DESTDIR="${pkgdir}" install

  chgrp 21 "${pkgdir}/usr/bin/locate"
  chmod 2755 "${pkgdir}/usr/bin/locate"
  ln -s locate "${pkgdir}/usr/bin/slocate"

  install -dm755 "${pkgdir}/var/lib"
  install -dm750 -g21 "${pkgdir}/var/lib/mlocate"

  install -Dm644 ${filedir}/updatedb.conf "${pkgdir}/etc/updatedb.conf"
  install -Dm744 ${filedir}/updatedb.cron "${pkgdir}/etc/cron.daily/updatedb"
}
