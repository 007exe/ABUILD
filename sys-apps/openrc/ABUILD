pkgname=openrc
pkgver=0.44.10
pkgbuild=2
arch=("auto")

shortdesc=("OpenRC manages the services, startup and shutdown of a host.")
longdesc=("OpenRC is a dependency-based init system that works with the system-provided init program, normally.")

source=("https://github.com/OpenRC/openrc/archive/${pkgver}.tar.gz")

tags=("base sys-apps")

build_deps=("glibc kernel-headers")

adddep=("etc sed grep sysvinit")

config_files=("etc/rc.conf
etc/conf.d/keymaps
etc/conf.d/hwclock
etc/conf.d/consolefont
etc/conf.d/modules
etc/conf.d/fsck
etc/conf.d/staticroute
etc/conf.d/hostname
etc/conf.d/bootmisc
etc/conf.d/localmount
etc/conf.d/network
etc/conf.d/urandom
etc/conf.d/dmesg")

build() {
  go_src_dir
  burn_patches
  export BRANDING="AgiliaLinux"
  make  LIBNAME=lib LIBEXECDIR=/lib/rc -j${numjobs} OS=Linux
  make install DESTDIR=${pkgdir} LIBNAME=lib LIBEXECDIR=/lib/rc OS=Linux

  install -m755 ${filedir}/consolefont ${pkgdir}/etc/init.d/consolefont

# Исправляем значения по умолчанию в файле конфигурации
  sed -i 's/#rc_parallel=.*$/rc_parallel="YES"/g' ${pkgdir}/etc/rc.conf
  sed -i 's/#unicode=.*$/unicode="YES"/g' ${pkgdir}/etc/rc.conf
  sed -i 's/#rc_sys=.*$/rc_sys=""/g' ${pkgdir}/etc/rc.conf

# Исправляем скрипт инициализации hwclock, чтобы он соответствовал переменной clock_synctohc.
  sed -i -e 's/clock_systohc/clock_synctohc/g' ${pkgdir}/etc/init.d/hwclock

# Не стирать tmp
  sed -i 's/wipe_tmp="YES"/wipe_tmp="NO"/g' ${pkgdir}/etc/conf.d/bootmisc

# Путь для urandom seed
  sed -i 's/urandom_seed=.*/urandom_seed="\/etc\/random-seed"/g' ${pkgdir}/etc/conf.d/urandom

# Шрифт консоли по умолчанию
  sed -i 's/default8x16/cyr-sun16/g' ${pkgdir}/etc/conf.d/consolefont
}
