pkgname=gsmartcontrol
pkgver=1.1.4
pkgbuild=1
arch=("auto")

shortdesc=("A graphical user interface for the smartctl hard disk drive health inspection tool.")

source=("https://github.com/ashaduri/gsmartcontrol/releases/download/v${pkgver}/gsmartcontrol-${pkgver}.tar.bz2")

tags=("apps sys-apps")

build_deps=("smartmontools gtkmm3 xorg-xmessage hicolor-icon-theme")

adddep=("smartmontools gtkmm3 xorg-xmessage hicolor-icon-theme")

# NOTE: Это опциональные зависимости
removedep=("polkit xterm")

build() {
  go_src_dir
  burn_patches
  sed -i "s|^Exec=.*|Exec="@prefix@/bin/gsmartcontrol_polkit"|" data/gsmartcontrol.desktop.in
  CXXFLAGS+=' -std=c++11' ./configure --prefix=/usr --sbindir=/usr/bin/
  make -j${numjobs}
  make DESTDIR=${pkgdir} install

# Скрипт запуска
  install -m755 ${filedir}/gsmartcontrol_polkit ${pkgdir}/usr/bin/gsmartcontrol_polkit

# Файл политики
  install -Dm644 ${filedir}/org.archlinux.pkexec.gsmartcontrol.policy ${pkgdir}/usr/share/polkit-1/actions/org.archlinux.pkexec.gsmartcontrol.policy
}
