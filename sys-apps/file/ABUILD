pkgname=file
pkgver=5.44
pkgbuild=1
arch=("auto")

shortdesc=("File type identification utility.")
longdesc=("The File package contains a utility for determining the type of a given file or files.")

source=("https://astron.com/pub/${pkgname}/${pkgname}-${pkgver}.tar.gz")

tags=("sys-apps base")

build_deps=("glibc zlib xz bzip2 libseccomp")

adddep=("libseccomp")

build() {
  go_src_dir
  burn_patches
#  autoreconf -fi
# libmagic (vfork нуждается в libpthread)
  CFLAGS+=" -pthread"
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib \
    --datadir=/usr/share/file \
    --enable-fsect-man5 \
    --disable-libseccomp
# FIXME: Проблемы при линковке с libseccomp
  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
  make -j${numjobs}
  make DESTDIR=${pkgdir} install

  install -Dm644 COPYING ${pkgdir}/usr/share/licenses/${pkgname}/COPYING
}
