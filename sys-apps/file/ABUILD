pkgname=file
pkgver=5.42
pkgbuild=1
arch=("auto")

shortdesc=("File type identification utility.")
longdesc=("The File package contains a utility for determining the type of a given file or files.")

source=("https://astron.com/pub/${pkgname}/${pkgname}-${pkgver}.tar.gz")

tags=("sys-apps base")

build_deps=("glibc zlib xz bzip2 libseccomp")

build() {
  go_src_dir
  burn_patches
  autoreconf -fi
  find -name .0*~ -delete
  CFLAGS+=" -pthread -Oz -D_GNU_SOURCE -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -pthread"
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib \
    --datadir=/usr/share/file \
    --enable-fsect-man5 \
    --enable-libseccomp \
    --enable-bzlib \
    --enable-xzlib \
    --enable-zlib
  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
#  make -j${numjobs}
#  make DESTDIR=${pkgdir} install
  make -C src magic.h
  make -C src file
  make -C src DESTDIR=${pkgdir} install

  install -Dm644 COPYING ${pkgdir}/usr/share/licenses/${pkgname}/COPYING
}
