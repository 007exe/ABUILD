pkgname=file
pkgver=5.40
pkgbuild=1
arch=('auto')

shortdesc="A utility to determine file type"
source=("https://astron.com/pub/${pkgname}/${pkgname}-${pkgver}.tar.gz")
tags="sys-apps base"

build_deps="zlib"

build() {
  go_src_dir
# Fix linking libmagic (vfork needs libpthread)
  CFLAGS+=" -pthread"

  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --datadir=/usr/share/file \
    --enable-fsect-man5 \
    --enable-libseccomp
  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
  make DESTDIR="$pkgdir" install

  install -Dm644 COPYING "$pkgdir/usr/share/licenses/$pkgname/COPYING"
}

