pkgname=file
pkgver=5.45
pkgbuild=1
arch=("auto")

shortdesc=("File type identification utility.")

source=("https://astron.com/pub/${pkgname}/${pkgname}-${pkgver}.tar.gz")

tags=("sys-apps base")

adddep=("glibc zlib xz bzip2 libseccomp zstd")

build_deps=("${adddep}")

build() {
  go_src_dir
  burn_patches
#  autoreconf -fi
# libmagic (vfork нуждается в libpthread)
  CFLAGS+=" -pthread"
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib \
    --datadir=/usr/share/file \
    --enable-fsect-man5 \
    --disable-libseccomp
# FIXME: Проблемы при линковке с libseccomp
  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
  make -j${numjobs}
  make DESTDIR=${pkgdir} install

  install -Dm644 COPYING ${pkgdir}/usr/share/licenses/${pkgname}/COPYING
}
