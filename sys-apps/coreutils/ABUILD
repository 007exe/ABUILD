pkgname=coreutils
pkgver=9.0
pkgbuild=3
arch=("auto")

shortdesc=("The GNU core utilities: a set of tools commonly used in shell scripts.")
longdesc=("The Coreutils package contains utilities for showing and setting the basic system characteristics.")

tags=("base sys-apps")

source=("http://ftp.gnu.org/gnu/coreutils/coreutils-${pkgver}.tar.xz")

build_deps=("acl attr gmp libcap openssl")

build() {
  go_src_dir
  burn_patches
  sed -i '/test.lock/s/^/#/' gnulib-tests/gnulib.mk
  autoreconf -fiv
# Поскольку сборка выполняется в среде fakeroot, следует снять ряд ограничений.
  FORCE_UNSAFE_CONFIGURE=1 ./configure \
    --prefix=/usr \
    --enable-no-install-program=groups,hostname,kill,uptime \
    --with-openssl \
    --sysconfdir=/etc \
    --enable-no-install-program=groups,hostname,kill,uptime
# NOTE: groups, hostname предоставляются пакетом inetutils.
# kill предоставляется пакетом psmisc.
# uptime предоставляется пакетом procps.
  make -j${numjobs}
  make DESTDIR=${pkgdir} install
# NOTE: Обратная совместимость
  mkdir -p $pkgdir/bin
  cp $pkgdir/usr/bin/* $pkgdir/bin/
}
