pkgname=coreutils
pkgver=9.0
pkgbuild=2
arch=("auto")

shortdesc=("The GNU core utilities: a set of tools commonly used in shell scripts")
longdesc=("The Coreutils package contains utilities for showing and setting the basic system characteristics.")

tags=("base sys-apps")

source=("http://ftp.gnu.org/gnu/coreutils/coreutils-${pkgver}.tar.xz")

build_deps=("acl attr gmp libcap openssl")

build() {
  go_src_dir
  burn_patches
  sed -i '/test.lock/s/^/#/' gnulib-tests/gnulib.mk
  autoreconf -fiv
# Since the assembly is performed in a fakeroot environment, a number of restrictions should be removed
  FORCE_UNSAFE_CONFIGURE=1 ./configure \
    --prefix=/usr \
    --enable-no-install-program=groups,hostname,kill,uptime \
    --with-openssl \
    --sysconfdir=/etc \
    --enable-no-install-program=groups,hostname,kill,uptime
# groups is provided by the inetutils shadow package
# hostname is provided by the inetutils package
# kill is provided by the psmisc package
# uptime is provided by the procps package
  make -j${numjobs}
  make DESTDIR=${pkgdir} install

# These are important enough that they should probably all go into /bin at this
# point...   Having some of them unavailable when /usr isn't mounted is just a
# source of unending bug reports for various third party applications.
# Time to end those reports.  :-)
  mkdir -p $pkgdir/bin
  ( cd $pkgdir/bin
    for file in ../usr/bin/* ; do
             ln --verbose -sf $file .
    done
  )
}
