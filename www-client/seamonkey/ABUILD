pkgname=seamonkey
pkgver=2.53.13
pkgbuild=1
arch=("auto")

shortdesc=("SeaMonkey internet suite.")
longdesc=("SeaMonkey features a state-of-the-art web browser and powerful email client, as well as a WYSIWYG web page composer and a feature-rich IRC chat client.")

source=("https://archive.mozilla.org/pub/seamonkey/releases/${pkgver}/source/seamonkey-${pkgver}.source.tar.xz")

tags=("apps www-client")

# mime-types
build_deps=("autoconf2.13 clang imake llvm mesa python python-setuptools rust yasm unzip zip nasm
dbus-glib gtk3 hunspell icu libevent libpulse libvpx libxt nss sqlite startup-notification")

# NOTE: Это опциональные зависимости
removedep=("networkmanager libnotify pulseaudio")

build() {
  go_src_dir
  burn_patches
  cp ${filedir}/mozconfig .mozconfig
  cat >> .mozconfig <<EOF
  ac_add_options --with-google-location-service-api-keyfile=${PWD@Q}/google-api-key
  ac_add_options --with-google-safebrowsing-api-keyfile=${PWD@Q}/google-api-key
  ac_add_options --with-mozilla-api-keyfile=${PWD@Q}/mozilla-api-key
EOF
  ./mach build
  DESTDIR=${pkgdir} INSTALL_SDK= ./mach install
  rm -rf ${pkgdir}/usr/lib/seamonkey/{dictionaries,hyphenation}
  ln -s /usr/share/hunspell ${pkgdir}/usr/lib/seamonkey/dictionaries
  ln -s /usr/share/hyphen ${pkgdir}/usr/lib/seamonkey/hyphenation
  
  install -Dm644 comm/suite/branding/seamonkey/default128.png ${pkgdir}/usr/share/pixmaps/seamonkey.png
  
  install -Dm644 toolkit/mozapps/installer/linux/rpm/mozilla.desktop ${pkgdir}/usr/share/applications/seamonkey.desktop
  
  sed -i 's/@MOZ_APP_DISPLAYNAME@/SeaMonkey internet suite/' ${pkgdir}/usr/share/applications/seamonkey.desktop
  
  sed -i 's/@MOZ_APP_NAME@/seamonkey/' ${pkgdir}/usr/share/applications/seamonkey.desktop
}

