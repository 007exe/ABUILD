pkgname=mpv
pkgver=0.33.1
pkgbuild=1
arch=('auto')

shortdesc=("a free, open source, and cross-platform media player")
longdesc=("Mpv is a movie player based on MPlayer and mplayer2. It supports a wide variety of video file formats, audio and video codecs, and subtitle types. Special input URL types are available to read input from a variety of sources other than disk files. Depending on platform, a variety of different video and audio output methods are supported.")

source=("https://github.com/mpv-player/mpv/archive/refs/tags/v${pkgver}.tar.gz")

tags="xapps media-video"
# libplacebo shaderc
build_deps="uchardet mujs rubberband libdvdnav ffnvcodec-headers lua52 libcdio libcdio-paranoia libdvdread python-docutils ladspa wayland-protocols vulkan-headers waf alsa-lib desktop-file-utils ffmpeg jack lcms2 libarchive libass libbluray libdrm libjpeg-turbo libglvnd libpulse libva libvdpau libx11 libxext libxinerama libxkbcommon libxrandr libxv mesa vulkan-icd-loader wayland xdg-utils zlib"

adddep="hicolor-icon-theme"

build(){
  go_src_dir
  waf configure --prefix=/usr \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --confdir=/etc/mpv \
    --disable-static \
    --disable-build-date \
    --disable-caca \
    --disable-android \
    --disable-egl-android \
    --disable-uwp \
    --disable-audiounit \
    --disable-macos-media-player \
    --disable-wasapi \
    --disable-ios-gl \
    --disable-macos-touchbar \
    --disable-macos-cocoa-cb \
    --disable-tvos \
    --disable-egl-angle-win3 \
    --enable-dvb \
    --enable-libarchive \
    --enable-libmpv-shared \
    --enable-dvdnav \
    --enable-cdda \
    --enable-libavdevice \
    --enable-manpage-build
  waf build
  waf install --destdir="$pkgdir"
  install -m0644 DOCS/{encoding.rst,tech-overview.txt} "$pkgdir"/usr/share/doc/mpv

  install -m0644 TOOLS/lua/* -D -t "$pkgdir"/usr/share/mpv/scripts
}
