# ABUILD generated by chip

pkgname=ncurses
pkgver=6.2
pkgbuild=2
arch=("auto")

shortdesc=("ncurses (CRT screen handling and optimization package)")
longdesc=("The ncurses (new curses) library is a free software emulation of curses in System V Release 4.0, and more. It uses terminfo format, supports pads and color and multiple highlights and forms characters and function-key mapping, and has all the other SYSV-curses enhancements over BSD curses.")

tags=("libs sys-libs compat32")

source=("https://ftp.gnu.org/pub/gnu/ncurses/${pkgname}-${pkgver}.tar.gz")

build_deps="glibc libtermcap"

build() {
  go_src_dir
  burn_patches
  set -e

  ./configure --prefix=/usr \
  --mandir=/usr/share/man \
  --with-pkg-config-libdir=/usr/lib${LIBDIRSUFFIX}/pkgconfig \
  --libdir=/usr/lib${LIBDIRSUFFIX} \
  --with-shared \
  --with-normal \
  --without-debug \
  --without-ada \
  --enable-widec \
  --enable-pc-files \
  --with-cxx-binding \
  --with-cxx-shared \
  --with-manpage-format=normal \
  --with-gpm \
  --disable-termcap \
  --enable-symlinks \
  --without-profile

  make
  make install DESTDIR=${pkgdir}
}

after_build() {
  go_src_dir

# fool packages looking to link to non-wide-character ncurses libraries
  for lib in ncurses ncurses++ form panel menu; do
    echo "INPUT(-l${lib}w)" > "$pkgdir/usr/lib${LIBDIRSUFFIX}/lib${lib}.so"
    ln -s ${lib}w.pc "$pkgdir/usr/lib${LIBDIRSUFFIX}/pkgconfig/${lib}.pc"
  done
  
  for lib in tic tinfo; do
    echo "INPUT(libncursesw.so.${pkgver:0:1})" > "$pkgdir/usr/lib${LIBDIRSUFFIX}/lib${lib}.so"
    ln -s libncursesw.so.${pkgver:0:1} "$pkgdir/usr/lib${LIBDIRSUFFIX}/lib${lib}.so.${pkgver:0:1}"
    ln -s ncursesw.pc "$pkgdir/usr/lib${LIBDIRSUFFIX}/pkgconfig/${lib}.pc"
  done
  
# some packages look for -lcurses during build
  echo 'INPUT(-lncursesw)' > "$pkgdir/usr/lib${LIBDIRSUFFIX}/libcursesw.so"
  ln -s libncurses.so "$pkgdir/usr/lib${LIBDIRSUFFIX}/libcurses.so"
}
