pkgname=erlang
pkgver=25.1.2
pkgbuild=1
arch=("auto")

shortdesc=("General-purpose concurrent functional programming language developed by Ericsson.")

source=("https://github.com/erlang/otp/archive/refs/tags/OTP-${pkgver}.tar.gz")

tags=("develop dev-lang")

# fop lksctp-tools
build_deps=("glu libxslt mesa perl unixodbc wxwidgets-gtk3 glu ncurses openssl webkit2gtk wxwidgets-gtk3")

adddep=("glu ncurses openssl webkit2gtk wxwidgets-gtk3")

build() {
  go_src_dir
  burn_patches
  sed -i 's/^LDFLAGS = /LDFLAGS += /g' lib/{odbc/c_src,megaco/src/flex}/Makefile.in
  export CFLAGS+=' -ffat-lto-objects'
  export WX_GKT_VER='3.2'
  ./otp_build autoconf
  ./configure \
    --enable-builtin-zlib \
    --enable-smp-support \
    --prefix=/usr \
    --with-odbc
  make -j${numjobs}
  export PATH="$srcdir/bin:$PATH"
  make DESTDIR=${pkgdir} install

  install -Dm644 ${filedir}/epmd.service ${pkgdir}/usr/lib/systemd/system/epmd.service
  install -Dm644 ${filedir}/epmd.socket ${pkgdir}/usr/lib/systemd/system/epmd.socket
  install -Dm644 ${filedir}/epmd.conf ${pkgdir}/etc/conf.d/epmd

  install -Dm644 README.md ${pkgdir}/usr/share/doc/${pkgname}/README.md
  install -Dm644 LICENSE.txt ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
  install -Dm644 CONTRIBUTING.md ${pkgdir}/usr/share/doc/${pkgname}/CONTRIBUTING.md
  install -Dm644 AUTHORS ${pkgdir}/usr/share/doc/${pkgname}/AUTHORS
}
