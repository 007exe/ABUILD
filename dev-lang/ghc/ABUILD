pkgname=ghc
pkgver=9.0.2
pkgbuild=1
arch=("auto")

shortdesc=("The Glasgow Haskell Compiler.")

source=("https://downloads.haskell.org/~ghc/${pkgver}/${pkgname}-${pkgver}-src.tar.xz")

tags=("develop dev-lang")

# ghc-static haskell-hscolour texlive-bin alex happy time
build_deps=("perl libxslt docbook-xsl python-sphinx texlive-latexextra ttf-dejavu numactl llvm")

build() {
  go_src_dir
  burn_patches
  LANG=en_US.UTF-8 bsdtar xf ${srcdir}/${pkgname}-${pkgver}-src.tar.xz
  ./boot
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib \
    --docdir=/usr/share/doc/ghc \
    --with-system-libffi \
    --with-ffi-includes=$(pkg-config --variable=includedir libffi)
  make -j${numjobs}
  make DESTDIR=${pkgdir} install

  install -m755 -d ${pkgdir}/usr/share/licenses/${pkgname}
  install -m644 COPYING ${pkgdir}/usr/share/licenses/${pkgname}/
}
