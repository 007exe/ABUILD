pkgname=go
pkgver=1.18.3
pkgbuild=1
arch=("auto")

shortdesc=("Core compiler tools for the Go programming language.")
longdesc=("A concurrent garbage collected and typesafe programming language.")

source=("https://go.dev/dl/go${pkgver}.src.tar.gz")

tags=("develop dev-lang")

build_deps=("go")

conflicts=("gcc-go")

build(){
  go_src_dir
  burn_patches
  export GOARCH=amd64
  export GOAMD64=v1
  export GOROOT_FINAL=/usr/lib/go
  export GOROOT_BOOTSTRAP=/usr/lib/go
  cd src
  ./make.bash -v

  cd ..
  install -d ${pkgdir}/usr/bin ${pkgdir}/usr/lib/go ${pkgdir}/usr/share/doc/go ${pkgdir}/usr/lib/go/pkg/linux_amd64_{dynlink,race}
  cp -a bin pkg src lib misc api test ${pkgdir}/usr/lib/go
  strip $STRIP_BINARIES ${pkgdir}/usr/lib/go{/bin/*,/pkg/tool/*/*}
  cp -r doc/* ${pkgdir}/usr/share/doc/go
  ln -sf /usr/lib/go/bin/go ${pkgdir}/usr/bin/go
  ln -sf /usr/lib/go/bin/gofmt ${pkgdir}/usr/bin/gofmt
  ln -sf /usr/share/doc/go ${pkgdir}/usr/lib/go/doc
  install -Dm644 VERSION ${pkgdir}/usr/lib/go/VERSION
  rm -rf ${pkgdir}/usr/lib/go/pkg/bootstrap ${pkgdir}/usr/lib/go/pkg/tool/*/api
  rm -rf ${pkgdir}/usr/lib/go/pkg/obj/go-build
  install -Dm644 LICENSE ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
}
