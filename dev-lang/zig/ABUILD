pkgname=zig
pkgver=0.11.0
pkgbuild=1
arch=("auto")

shortdesc=("A general-purpose programming language and toolchain for maintaining robust, optimal, and reusable software.")

source=("https://ziglang.org/download/${pkgver}/zig-${pkgver}.tar.xz")

tags=("develop dev-lang")

adddep=("clang lld llvm-libs")

build_deps=("${adddep} cmake llvm")

build(){
  go_src_dir
  burn_patches
  cmake -B build . \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_INSTALL_LIBDIR=lib \
    -DCMAKE_BUILD_TYPE=None \
    -DZIG_SHARED_LLVM=ON \
    -DZIG_TARGET_MCPU=baseline
  cmake --build build -j${numjobs}
  DESTDIR=${pkgdir} cmake --install build
  install -Dm644 LICENSE ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
}
