# ABUILD generated by mkpkg_generator.sh

pkgname=mailx
pkgver=12.5
pkgbuild=1
arch=("auto")

shortdesc=("mailx (a simple mail client)")
longdesc=("Mailx is derived from Berkeley Mail and is intended provide the functionality of the POSIX mailx command with additional support for MIME, IMAP, POP3, SMTP, and S/MIME. It provides enhanced features for interactive use, such as caching and disconnected operation for IMAP, message threading, scoring, and filtering. It is also usable as a mail batch language, both for sending and receiving mail. The maintainer and primary developer of mailx is Gunnar Ritter.")
tags=("network mail-client")
source=("")
_srca="${srcache}/${pkgname}-${pkgver}.tar.xz"
build_deps="glibc-solibs openssl-solibs cvs"


_makeflags="PREFIX=/usr \
  MAILRC=/etc/mail.rc \
  SENDMAIL=/usr/sbin/sendmail \
  MAILSPOOL=/var/spool/mail \
  UCBINSTALL=/usr/bin/install"

mksource() {
  cd ${srcache}
  export CVSROOT=:pserver:anonymous@nail.cvs.sourceforge.net:/cvsroot/nail
  D=nail
  [ -d "${D}" ] && cvs up "${D}" || cvs co "${D}"

  _dirname=${pkgname}-${pkgver}
  mv $D ${_dirname}
  tar -cJv --exclude=CVS -f ${_dirname}.tar.xz ${_dirname}
  rm -rf ${_dirname}
}

build() {
  if [ ! -f ]; then
    mksource
  fi
  mkdir -p ${srcdir}
  unpack ${srcache}/${pkgname}-${pkgver}.tar.xz

  go_src_dir
  sed -i 's|/etc/nail.rc|/etc/mail.rc|g' mailx.1

  # For Linux and BSD, this should be set.
  echo "set bsdcompat" >> nail.rc

  sed -i "s/pg/less/" cmd1.c

  make ${_makeflags} IPv6=-DHAVE_IPv6_FUNCS
}

after_build() {
  go_src_dir
  make DESTDIR="${pkgdir}" ${_makeflags} install

  # For compatibility with the old mailx program
  ln -sf mailx "${pkgdir}"/usr/bin/mail
  ln -sf mailx.1.gz "${pkgdir}"/usr/share/man/man1/mail.1.gz

  install -D -m0644 COPYING "${pkgdir}"/usr/share/licenses/${pkgname}/LICENSE
}
