pkgname=sudo
pkgver=1.9.7p2
pkgbuild=1
arch=("auto")

shortdesc=("Allows command execution as root for specified users")
longdesc=("Sudo (superuser do) allows a system administrator to give certain users (or groups of users) the ability to run some (or all) commands as root while logging all commands and arguments. Sudo operates on a per-command basis.")

tags=("console sys-auth")

source=("http://www.sudo.ws/sudo/dist/$pkgname-$pkgver.tar.gz")

build_deps="glibc linux-pam libaudit zlib"

config_files="etc/sudoers"

build() {
  go_src_dir
  burn_patches
  ./configure \
    --prefix=/usr \
    --sbindir=/usr/bin \
    --libdir=/usr/lib$LIBDIRSUFFIX \
    --libexecdir=/usr/lib${LIBDIRSUFFIX} \
    --disable-env-reset \
    --with-logfac=auth \
    --with-pam \
    --with-env-editor \
    --with-all-insults \
    --with-rundir=/run/sudo \
    --with-vardir=/var/db/sudo \
    --enable-tmpfiles.d \
    --with-sssd \
    --with-ldap \
    --with-passprompt="[sudo] password for %p: "

  make -j${numjobs}
  make DESTDIR=${pkgdir} install

  install -Dm0644 ${filedir}/sudo.pam ${pkgdir}/etc/pam.d/sudo
}
