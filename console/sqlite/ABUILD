# ABUILD generated by mkpkg_generator.sh

pkgname=sqlite
pkgver=3.33.2
pkgbuild=2
arch=('auto')
_amalgamationver=3330000

shortdesc=("Sqlite (Small C library that implements a SQL database engine)")

longdesc=("SQLite is a small C library that implements a self-contained, embeddable, zero-configuration SQL database engine. The SQLite distribution comes with a standalone command-line access program (sqlite) that can be used to administer an SQLite database and which serves as an example of how to use the SQLite library.")

tags=('console dev-db')

build_deps="make gcc ncurses readline binutils coreutils sed grep kernel-headers"

# What kind of drugs did they use to switch to such versioning system in 3.7.4? It's definitely out of my understanding abilities...
source=("http://sqlite.org/2020/sqlite-autoconf-${_amalgamationver}.tar.gz"
        "http://www.sqlite.org/2020/sqlite-doc-${_amalgamationver}.zip")

pkglist="sqlite-doc"

# Options: SECURE_DELETE is for xulrunner, others are from ArchLinux PKGBUILD
SLKCFLAGS="$SLKCFLAGS -DSQLITE_SECURE_DELETE -DSQLITE_ENABLE_FTS3=1 -DSQLITE_ENABLE_COLUMN_METADATA=1 -DSQLITE_ENABLE_UNLOCK_NOTIFY"

# fix for http://trac.agilialinux.ru/ticket/1100
export LTLINK_EXTRAS="-ldl"

BUILD_SYSTEM='autotools'
BUILD_KEYS="--prefix=/usr \
	--mandir=/usr/man \
	--libdir=/usr/lib${LIBDIRSUFFIX} \
	--program-prefix= \
	--program-suffix= \
	--disable-static \
	--enable-shared \
	--enable-threadsafe \
	--enable-readline \
	--enable-dynamic-extensions"

INSTALL_KEYS="DESTDIR=${pkgdir}"

sqlite-doc() {
  pkgname=sqlite-doc
  shortdesc=("Most of the static HTML files that comprise this website, including all of the SQL Syntax and the C/C++ interface specs and other miscellaneous documentation")
}

sqlite-doc_prep() {
  cd ${srcdir}/sqlite-doc-${_amalgamationver}
  mkdir -p ${pkgdir}/usr/doc/sqlite-${pkgver}
  cp -R *  ${pkgdir}/usr/doc/sqlite-${pkgver}/

  # fix permissions and remove obsolete files; https://bugs.archlinux.org/task/24605
  find ${pkgdir} -type f -perm 755 -exec ls -lha {} \;
  find ${pkgdir} -type f -perm 755 -exec chmod 644 {} \;

  find ${pkgdir} -type f -name '*~' -exec ls -lha {} \;
  find ${pkgdir} -type d -name '*~' -exec ls -lha {} \;
  find ${pkgdir} -name '*~' -exec rm -f {} \;

  find ${pkgdir} -type f -name '.~*' -exec ls -lha {} \; 
  find ${pkgdir} -type d -name '.~*' -exec ls -lha {} \;
  find ${pkgdir} -name '.~*' -exec rm -f {} \;
}
