# ABUILD generated by mkpkg_generator.sh

pkgname=timidity++
pkgver=2.14.0
freepats_ver=20060219
pkgbuild=1
arch=("auto")
shortdesc=("software synthesizer that can play MIDI files without a hardware synthesizer")
longdesc=("software synthesizer that can play MIDI files without a hardware synthesizer")

tags=("media-sound utils")

source=("http://downloads.sourceforge.net/timidity/TiMidity++-${pkgver}.tar.xz"
"http://freepats.zenvoid.org/freepats-${freepats_ver}.tar.bz2 n")
build_deps="cxxlibs glibc-solibs atk audiofile expat libao libogg libpng ncurses slang zlib fontconfig libXau libXdmcp pixman tcl libao freetype libvorbis libxcb libX11 libXcomposite libXext libXfixes libXrender libXScrnSaver libXcursor libXdamage libXft libXi libXinerama libXrandr tk alsa-lib glib2 cairo pango gdk-pixbuf gtk+2 gcc ncurses"

before_build() {
  go_src_dir
  sed -i -e 's/tcl8.5/tcl8.6 tcl8.5/' -e 's/tk8.5/tk8.6 tk8.5/' configure
  sed -i 's/my_interp->result/(char *) Tcl_GetObjResult(my_interp)/' interface/tk_c.c
}

BUILD_SYSTEM="autotools"
BUILD_KEYS="--prefix=/usr --libdir=/usr/lib$LIBDIRSUFFIX --mandir=/usr/man --sysconfdir=/etc \
    --with-default-path=/etc/timidity++/ \
    --enable-server --enable-alsaseq --enable-spectrogram --enable-network --enable-xft \
    --enable-audio=alsa,oss,ao,vorbis,flac \
    --enable-dynamic=ncurses,tcltk,vt100,gtk"

INSTALL_KEYS="DESTDIR=$pkgdir"

after_build() {
  cd ${srcdir}
  #install freepats
  tar xf ${srcache}/freepats-${freepats_ver}.tar.bz2
  install -d ${pkgdir}/usr/share/timidity/freepats/{Drum,Tone}_000/
  install -m644 ${srcdir}/freepats/Drum_000/*.pat \
      ${pkgdir}/usr/share/timidity/freepats/Drum_000/
  install -m644 ${srcdir}/freepats/Drum_000/*.txt \
      ${pkgdir}/usr/share/timidity/freepats/Drum_000/
  install -m644 ${srcdir}/freepats/Tone_000/*.pat \
      ${pkgdir}/usr/share/timidity/freepats/Tone_000/
  install -m644 ${srcdir}/freepats/Tone_000/*.txt \
      ${pkgdir}/usr/share/timidity/freepats/Tone_000/
  install -Dm644 ${srcdir}/freepats/crude.cfg \
      ${pkgdir}/etc/timidity++/freepats/freepats.cfg
  install -m644 ${filedir}/timidity-freepats.cfg \
      ${pkgdir}/etc/timidity++/
}