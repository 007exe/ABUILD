pkgname=jdk-openjdk
_majorver=18
_minorver=0
_securityver=2.1
_updatever=0
_git_tag=jdk-${_majorver}.${_minorver}.${_securityver}+${_updatever}
pkgver=${_majorver}.${_minorver}.${_securityver}.u${_updatever}
pkgbuild=1
arch=("auto")

shortdesc=("OpenJDK Java ${_majorver} development kit.")

tags=("libs dev-java")

source=("https://github.com/openjdk/jdk${_majorver}u/archive/${_git_tag}.tar.gz")

# java-environment-common
build_deps=("cpio unzip zip libelf libcups libx11 libxrender libxtst libxt libxext
libxrandr alsa-lib pandoc graphviz freetype libjpeg-turbo giflib libpng lcms2 libnet
bash harfbuzz gcc-libs glibc")

# java-environment-common
adddep=("hicolor-icon-theme")

pkglist=("jre-openjdk-headless jre-openjdk openjdk-src openjdk-doc")

build() {
  go_src_dir
  burn_patches
  unset CFLAGS
  unset CXXFLAGS
  unset LDFLAGS
  bash configure \
    --with-version-build="${_updatever}" \
    --with-version-pre="" \
    --with-version-opt="" \
    --with-stdc++lib=dynamic \
    --with-extra-cflags="${_CFLAGS}" \
    --with-extra-cxxflags="${_CXXFLAGS}" \
    --with-extra-ldflags="${_LDFLAGS}" \
    --with-libjpeg=system \
    --with-giflib=system \
    --with-libpng=system \
    --with-lcms=system \
    --with-zlib=system \
    --with-harfbuzz=system \
    --with-jvm-features=zgc \
    --enable-unlimited-crypto \
    --disable-warnings-as-errors
  make images legacy-jre-image docs
  find "../${_imgdir}" -iname '*.so' -exec chmod +x {} \;
}
