pkgname=graphite
pkgver=1.3.14
pkgbuild=1
arch=('auto')

shortdesc=("Font rendering capabilities for complex non-Roman writing systems")
longdesc=("Is a project within SILs Non-Roman Script Initiative and Language Software Development groups to provide rendering capabilities for complex non-Roman writing systems. Graphite can be used to create smart fonts capable of displaying writing systems with various complex behaviors. With respect to the Text Encoding Model, Graphite handles the Rendering aspect of writing system implementation.")

source=("https://github.com/silnrsi/graphite/releases/download/${pkgver}/graphite2-${pkgver}.tgz")

tags="libs media-libs"
# doxygen dblatex graphviz
build_deps="cmake freetype python asciidoc"

build() {
  mkdir build
  cd build
  cmake -G "Unix Makefiles" ../graphite2-${pkgver} \
    -DCMAKE_C_FLAGS:STRING="${CFLAGS}" \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_BUILD_TYPE=RELEASE \
    -DGRAPHITE2_COMPARE_RENDERER=OFF \
    -DLIB_DIR=lib${LIBDIRSUFFIX} \
    -DLIB_SUFFIX=${LIBDIRSUFFIX}
# fix unwanted -O3 cflag (taken form Debian)
  find . -type f ! -name "rules" ! -name "changelog" -exec sed -i -e 's/\-O3//g' {} \;
  make -j${numjobs}
  make -j1 docs
  make DESTDIR=${pkgdir} install

# install doc files
  mkdir -p "${pkgdir}"/usr/share/doc/graphite2/api
#  cp -vrf doc/doxygen/{html,latex/refman.pdf} "${pkgdir}"/usr/share/doc/graphite2/api
  cp -vrf doc/{GTF,manual}.html "${pkgdir}"/usr/share/doc/graphite2

# licenses
  mkdir -p "${pkgdir}"/usr/share/licenses/${pkgname}
  install -m644 "${srcdir}"/graphite2-${pkgver}/COPYING "${pkgdir}"/usr/share/licenses/${pkgname}/
}
