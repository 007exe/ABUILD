pkgname=gimp
pkgver=2.10.34
pkgbuild=1
arch=("auto")

shortdesc=("GNU Image Manipulation Program.")

source=("https://download.gimp.org/gimp/v${pkgver%.*}/gimp-${pkgver}.tar.bz2")

tags=("apps media-gfx")

# mypaint-brushes1
adddep=("babl dbus-glib desktop-file-utils gegl glib-networking hicolor-icon-theme openjpeg2
lcms2 libheif libexif libgudev libjxl libmng libmypaint librsvg libwebp libwmf libxmu libxpm
openexr poppler-data gtk2 graphviz")

build_deps=("${adddep} alsa-lib curl ghostscript gtk-doc intltool iso-codes poppler-glib")

# NOTE: Это опциональные зависимости
removedep=("gutenprint poppler-glib alsa-lib curl ghostscript gvfs")

build() {
  go_src_dir
  burn_patches
  sed -i -e 's/mypaint-brushes-1.0/mypaint-brushes-2.0/' configure.ac || die #737794
  autoreconf -vi --force
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib \
    --sysconfdir=/etc \
    --enable-mp \
    --enable-gimp-console \
    --disable-gtk-doc \
    --disable-check-update \
    --disable-python \
    --with-openexr \
    --without-aa
  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
  make -j${numjobs}
  make DESTDIR=${pkgdir} install
  install -D -m644 ${filedir}/linux.gpl ${pkgdir}/usr/share/gimp/2.0/palettes/Linux.gpl

  rm ${pkgdir}/usr/share/man/man1/gimp-console.1
  ln -s gimp-console-${pkgver%.*}.1.gz ${pkgdir}/usr/share/man/man1/gimp-console.1.gz
  ln -s gimptool-2.0 ${pkgdir}/usr/bin/gimptool
  ln -sf gimptool-2.0.1.gz ${pkgdir}/usr/share/man/man1/gimptool.1.gz
}
