# ABUILD generated by mkpkg_generator.sh

pkgname=wicd
pkgver=1.7.2.4
pkgbuild=1
arch=("auto")

shortdesc=("wicd (network manager for linux)")
longdesc=("wicd is a wired and wireless network manager for Linux. Some features include: - Ability to connect to wired and wireless networks - Profiles for each wireless network and wired network - Many encryption schemes, some of which include WEP/WPA/WPA2 - Compatible with wireless-tools Homepage: http://wicd.net")

tags=("net-misc network")

source=("https://launchpad.net/wicd/1.7/$pkgver/+download/$pkgname-$pkgver.tar.gz")

build_deps="python python-babel pysetuptools gettext dbus-glib dhcpcd \
  ethtool inetutils net-tools pygtk python-dbus python-gobject urwid \
  rfkill shared-mime-info wireless-tools wpa_supplicant hicolor-icon-theme"
adddep="python dbus python-dbus dhcpcd wireless-tools wpa_supplicant shared-mime-info \
 ethtool inetutils net-tools python-gobject urwid dbus-glib rfkill"

pkglist="gtk"

before_build() {
  go_src_dir
  # Asturian is faulty with PyBabel
  # (https://bugs.launchpad.net/wicd/+bug/928589)
  rm po/ast.po
  # zh_CN fails with newer PyBabel (Aug 2013)
  rm po/zh_CN.po
}


BUILD_SYSTEM="python"
MAKE_WORD="python setup.py configure \
  --distro=gentoo \
  --lib=/usr/lib${LIBDIRSUFFIX} \
  --docdir=/usr/doc/${pkgname}-${pkgver} \
  --mandir=/usr/man \
  --resume=/usr/share/wicd/scripts/ \
  --suspend=/usr/share/wicd/scripts/ \
  --verbose \
  --python=/usr/bin/python"

after_build() {
  go_src_dir

  #install -Dm755 ${filedir}/wicd.init $pkgdir/etc/init.d/wicd
  #install -Dm644 ${filedir}/wicd.desktop $pkgdir/usr/share/applications/wicd.desktop

  cd build/lib/wicd
  for i in *.py; do
    install -Dm 755 $i $pkgdir/usr/lib${LIBDIRSUFFIX}/wicd/$i
  done

  rm -rf $pkgdir/usr/share/autostart


  #deleting the GTK stuff
  rm -rf "$pkgdir"/etc/xdg
  rm -f "$pkgdir"/usr/bin/{wicd-client,wicd-gtk}
  rm -rf "$pkgdir"/usr/share/{applications,icons,pixmaps}
  rm -rf "$pkgdir"/usr/share/wicd/gtk

  # This sets dhcpcd as the default dhcp client in the Preferences dialog
cat << EOF > ${pkgdir}/etc/wicd/manager-settings.conf.new
[Settings]
dhcp_client = 2
EOF

}

gtk() {
  pkgname=wicd-gtk
  shortdesc="Wired and wireless network manager for Linux - GTK client"
  adddep="wicd pygtk hicolor-icon-theme"
}

gtk_prep(){
  go_src_dir
  python setup.py install --optimize=1 --root="$pkgdir"

  #install -Dm644 "$filedir/wicd.desktop" "$pkgdir/usr/share/applications/wicd.desktop"

  # If even there is systemd it is in main package already.
  rm -rf $pkgdir/lib
  # Clean
  rm -rf $pkgdir/usr/sbin


  #deleting the core dirs which exists in wicd
  rm -rf "$pkgdir"/etc/{wicd,dbus-1,rc.d,logrotate.d}
  rm -rf "$pkgdir"/usr/lib${LIBDIRSUFFIX}
  rm -rf "$pkgdir"/usr/share/{man,doc,locale,wicd/curses,wicd/daemon,wicd/backends,wicd/scripts,wicd/cli}
  rm -rf "$pkgdir"/var
  rm -f "$pkgdir"/usr/{bin,sbin}/{wicd,wicd-curses,wicd-cli}
  rm -rf "$pkgdir"/usr/share/autostart
  rm -rf "$pkgdir"/usr/share/dbus-1
}
