# ABUILD generated by mkpkg_generator.sh

pkgname=foomatic-db
pkgbase=foomatic
_snapdate=20110410
_relver=4.0.7
pkgver=${_relver}_${_snapdate}

pkgbuild=1
arch=("noarch")

shortdesc=("The OpenPrinting (foomatic) database")
longdesc=("Foomatic - The collected knowledge about printers, drivers, and driver options in XML files, used by foomatic-db-engine to generate PPD files.")

tags=("console net-print")
pkglist="engine nonfree filters"
adddep="perl libxml2"
source=("http://www.linuxprinting.org/download/foomatic/$pkgbase-filters-${_relver}.tar.gz"
	"http://www.linuxprinting.org/download/foomatic/$pkgbase-db-engine-${_relver}.tar.gz"
        "http://www.linuxprinting.org/download/foomatic/$pkgbase-db-4.0-${_snapdate}.tar.gz"
        "http://www.linuxprinting.org/download/foomatic/$pkgbase-db-nonfree-${_snapdate}.tar.gz")

filters() {
	pkgname=foomatic-filters
	shortdesc=("Universal print filter/RIP wrapper")
	longdesc=("Foomatic - Filter scripts used by the printer spoolers to convert the incoming PostScript data into the printer's native format.")
	arch=("auto")
 	config_files="etc/foomatic/filter.conf"
}

engine() {
	pkgname=foomatic-db-engine
	shortdesc=("Foomatic - Foomatic's database engine")
	longdesc=("Foomatic - Foomatic's database engine generates PPD files from the data in Foomatic's XML database. It also contains scripts to directly generate print queues and handle jobs.")
	arch=("auto")
	adddep="foomatic-filters bash perl libxml2"
}


nonfree() {
	pkgname=foomatic-db-nonfree
	shortdesc=("Foomatic - database extension consisting of manufacturer-supplied PPD files released under non-free licenses")
	longdesc=("Foomatic - database extension consisting of manufacturer-supplied PPD files released under non-free licenses")
	arch=("noarch")
	adddep="foomatic-db foomatic-db-engine perl libxml2"
}

filters_prep() {
	set -e
	cd ${srcdir}/foomatic-filters-${_relver}
	./configure --prefix=/usr --sysconfdir=/etc --libdir=/usr/lib${LIBDIRSUFFIX} --mandir=/usr/man
	make -j${numjobs}
	make DESTDIR=${pkgdir} install
	set +e

}

engine_prep() {
	set -e
	cd ${srcdir}/foomatic-db-engine-${_relver}
	./configure --prefix=/usr --libdir=/usr/lib${LIBDIRSUFFIX} --mandir=/usr/man
	make -j${numjobs}
	eval `perl -V:archname`
	make DESTDIR=${pkgdir} \
		INSTALLARCHLIB=/usr/lib${LIBDIRSUFFIX}/perl5/vendor_perl/ \
		INSTALLSITELIB=/usr/lib${LIBDIRSUFFIX}/perl5/vendor_perl/ \
		INSTALLSITEARCH=/usr/lib${LIBDIRSUFFIX}/perl5/vendor_perl/ install
	/usr/bin/find ${pkgdir} -name '.packlist' -delete
	# fix permissions
	chmod 755 ${pkgdir}/usr/lib${LIBDIRSUFFIX}{,/perl5,/perl5/vendor_perl}
	set +e

}

nonfree_prep() {
	set -e
	cd ${srcdir}/foomatic-db-nonfree-${_snapdate}
	./configure --prefix=/usr --libdir=/usr/lib${LIBDIRSUFFIX} --mandir=/usr/man
	make DESTDIR=${pkgdir} install
	set +e

}

build() {
	set -e
	cd ${srcdir}/${pkgname}-${_snapdate}
	./configure --prefix=/usr --libdir=/usr/lib${LIBDIRSUFFIX} --mandir=/usr/man
	make DESTDIR=${pkgdir} install
	set +e
}


