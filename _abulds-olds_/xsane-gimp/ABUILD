# ABUILD generated by mkpkg_generator.sh

pkgname=xsane
pkgver=0.998
pkgbuild=4
arch=("auto")

shortdesc=("xsane (Graphical frontend to SANE, Scanner Access Now Easy)")
longdesc=("xsane provides a graphical user-interface to control an image acquisition device such as a flatbed scanner. It allows previewing and scanning individual images and can be invoked either directly from the command-line or through the GIMP image manipulation program. xsane accesses image acquisition devices through the SANE (Scanner Access Now Easy) interface.")

tags=("media-gfx xapps")
pkglist="gimp"

source=("http://www.xsane.org/download/$pkgname-$pkgver.tar.gz")
build_deps="gtk+2 lcms sane zlib libjpeg gimp"

build() {
	go_src_dir
	burn_patches

	# Fix compability with libpng15
	sed -i -e 's:png_ptr->jmpbuf:png_jmpbuf(png_ptr):' src/xsane-save.c || die

	CONFIG_OPTS="--prefix=/usr --mandir=/usr/man --libdir=/usr/lib${LIBDIRSUFFIX}"
	./configure $CONFIG_OPTS --enable-gimp
	make -j${numjobs}
	mv src/xsane src/xsane-gimp
	make clean
	./configure $CONFIG_OPTS --disable-gimp
	make -j${numjobs}
	make install DESTDIR=${pkgdir}
}

gimp() {
	pkgname="xsane-gimp"
	shortdesc="XSane GIMP plugin"
	longdesc="XSane GIMP plugin"
	adddep="xsane"
}

gimp_prep() {
	install -D -m755 src/xsane-gimp ${pkgdir}/usr/bin/xsane-gimp
	mkdir -p ${pkgdir}/usr/lib${LIBDIRSUFFIX}/gimp/2.0/plug-ins
	( cd ${pkgdir}/usr/lib${LIBDIRSUFFIX}/gimp/2.0/plug-ins/ ; ln -s ../../../../bin/xsane-gimp xsane )
}
