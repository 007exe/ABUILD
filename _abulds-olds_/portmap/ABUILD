# ABUILD generated by mkpkg_generator.sh

pkgname=portmap
pkgver=6.0
pkgbuild=3
arch=('auto')

shortdesc=('portmap (a daemon to manage RPC connections)')
longdesc=('The portmapper (/sbin/rpc.portmap) is a network daemon used to manage connections to RPC services. Daemons that offer RPC services (such as the daemons for NFS) tell the portmapper on what port they listen. Unlike the services registered with the inetd, RPC network port numbers may change each time the system is booted. The portmapper is required to use NFS or other RPC services.')

tags=('network net-fs')

source=("http://neil.brown.name/portmap/portmap-${pkgver}.tgz")

build_deps='glibc-solibs'

build() {
	go_src_dir
	burn_patches
	mkdir -p $pkgdir/usr/doc/portmap-$pkgver
	cp -a \
		BLURB* CHANGES README* \
		$pkgdir/usr/doc/portmap-$pkgver
		chmod 644 $pkgdir/usr/doc/portmap-$pkgver/*

	make || exit 1

	strip portmap pmap_dump pmap_set
	mkdir -p $pkgdir/sbin
	cat portmap > $pkgdir/sbin/rpc.portmap
	chmod 755 $pkgdir/sbin/rpc.portmap
	mkdir -p $pkgdir/usr/sbin
	cat pmap_dump > $pkgdir/usr/sbin/pmap_dump
	cat pmap_set > $pkgdir/usr/sbin/pmap_set
	chmod 755 $pkgdir/usr/sbin/*
	
	mkdir -p $pkgdir/usr/man/man8
	for file in *.8 ; do
		cat ${file} | gzip -9c > $pkgdir/usr/man/man8/${file}.gz
	done
	( cd $pkgdir/usr/man/man8 ; ln -sf portmap.8.gz rpc.portmap.8.gz )

	# Now let's add a recent version of /etc/rpc for good measure:
	if [ -r ${filedir}/rpc ]; then
		mkdir -p $pkgdir/etc
		cp -a ${filedir}/rpc $pkgdir/etc/rpc
	fi

	mkdir -p $pkgdir/etc/{init.d,conf.d}
	install -m755 ${filedir}/portmap ${pkgdir}/etc/init.d/portmap
	install -m644 ${filedir}/portmap.conf.d ${pkgdir}/etc/conf.d/portmap.new
}
