# ABUILD generated by mkpkg_generator.sh

pkgname=rpm
pkgver=4.12.0.2
pkgbuild=1
arch=("auto")

shortdesc=("RPM package format tool")
longdesc=("RPM is a tool from Red Hat Software used to install and remove packages in the .rpm format. When installing RPM packages on Slackware, you may need to use the --nodeps and --force options. Before installing any binary package, it's wise to examine it to see what it's going to do, and if it will overwrite any files. You can use rpm2tgz to convert .rpm packages to .tgz packages so you can look them over.")
tags=("console app-arch")
#source=("http://rpm.org/releases/rpm-${pkgver%.*.*}.x/${pkgname}-${pkgver}.tar.bz2")
source=("http://ftp.rpm.org/releases/${pkgname}-${pkgver%.*}.x/${pkgname}-${pkgver}.tar.bz2")
build_deps="file glibc-solibs sqlite popt xz pcre zlib python gnupg elfutils perl nss nspr acl libcap"
conflicts="rpmextract"

before_build() {
    go_src_dir
    sed -i 's:%{_var}/tmp:/var/tmp:' macros.in || die "Fixing tmppath failed"
    autoreconf
    touch -r Makefile.am preinstall.am
}

BUILD_SYSTEM="autotools"
BUILD_KEYS="CPPFLAGS=\"-I/usr/include/nspr -I/usr/include/nss\" \
  --prefix=/usr \
  --libdir=/usr/lib$LIBDIRSUFFIX \
  --localstatedir=/var \
  --mandir=/usr/man \
  --sysconfdir=/etc \
  --enable-python \
  --with-external-db \
  --without-selinux \
 # --without-beecrypt \
  --with-crypto = beecrypt \
  --without-lua \
  --with-cap \
  --with-acl"

INSTALL_KEYS="DESTDIR=$pkgdir"

after_build() {
  go_src_dir
  mv $pkgdir/bin/rpm $pkgdir/usr/bin/rpm
  rmdir $pkgdir/bin

  # fix symlinks to /bin/rpm
  for binary in rpmquery rpmverify; do
    ln -sf rpm $pkgdir/usr/bin/${binary}
  done

  # package provides rpm2cpio, so adding rpmextract.sh and set rpmextract to conflicts
  install -D -m755 ${filedir}/rpmextract.sh $pkgdir/usr/bin/rpmextract
}
