pkgname=ca-certificates
pkgver=20210603
pkgbuild=1
arch=("noarch")
url="https://src.fedoraproject.org/rpms/ca-certificates"

shortdesc=("Common CA certificates.")
longdesc=("Common CA certificates.")

tags=("network net-misc")

build_deps=("asciidoc p11-kit")

adddep=("bash coreutils findutils p11-kit ca-certificates-mozilla")

build(){
  cd ${filedir}
#  cp ${filedir}/update-ca-trust ${srcdir}/update-ca-trust
#  cp ${filedir}/update-ca-trust.8.txt ${filedir}/update-ca-trust.8.txt
  asciidoc -v -d manpage -b docbook update-ca-trust.8.txt
#  xsltproc --nonet -o update-ca-trust.8 /etc/asciidoc/docbook-xsl/manpage.xsl update-ca-trust.8.xml

  install -Dt ${pkgdir}/usr/bin update-ca-trust
#  install -Dt ${pkgdir}/usr/share/man/man8 -m644 update-ca-trust.8

  install -d ${pkgdir}/{etc,usr/share}/ca-certificates/trust-source/{anchors,blocklist}
  install -d ${pkgdir}/etc/{ssl/certs/{edk2,java},ca-certificates/extracted}

  ln -sr ${pkgdir}/etc/ca-certificates/extracted/tls-ca-bundle.pem ${pkgdir}/etc/ssl/cert.pem

# MPKG hooks
  install -Dm0755 ${filedir}/update-ca-trust.sh ${pkgdir}/etc/mpkg/hooks/update-ca-trust.sh
}
