# NOTE: В будущем этот пакет стоит разделить на:
# pipewire alsa-card-profiles pipewire-docs pipewire-audio pipewire-alsa pipewire-jack
# pipewire-pulse gst-plugin-pipewire pipewire-zeroconf pipewire-v4l2 pipewire-x11-bell
# NOTE: Рассмотреть заману pulseaudio на pipewire
pkgname=pipewire
pkgver=0.3.80
pkgbuild=1
arch=("auto")

shortdesc=("Low-latency audio/video router and processor.")

source=("https://github.com/PipeWire/pipewire/archive/${pkgver}/pipewire-${pkgver}.tar.gz")

tags=("libs media-libs")

build_deps=("alsa-lib bluez-libs avahi dbus doxygen graphviz gst-plugins-base libcanberra
libfdk-aac libfreeaptx libldac libpulse libsndfile libusb libx11 libxfixes lilv meson ncurses
python-docutils sbc sdl2 valgrind webrtc-audio-processing rtkit liblc3")

build() {
  go_src_dir
  burn_patches
  meson build \
    -D buildtype=release \
    -D prefix=/usr \
    -D libdir=/usr/lib \
    -D bluez5-codec-lc3plus=disabled \
    -D docs=enabled \
    -D jack=disabled \
    -D jack-devel=true \
    -D libjack-path=/usr/lib \
    -D libcamera=disabled \
    -D udevrulesdir=/usr/lib/udev/rules.d \
    -D roc=disabled \
    -D session-managers=[]
  meson compile -C build
  meson install -C build --destdir ${pkgdir}
}
