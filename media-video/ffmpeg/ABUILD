pkgname=ffmpeg
pkgver=6.0
pkgbuild=1
arch=("auto")

shortdesc=("Complete solution to record, convert and stream audio and video.")

source=("http://ffmpeg.org/releases/${pkgname}-${pkgver}.tar.xz")

tags=("libs media-video")

adddep=("libmfx libsoxr vmaf rav1e dav1d aom svt-av1 zimg vidstab v4l-utils libvpx jack librsvg libpulse
sdl2 fontconfig fribidi libraw1394 libssh libxml2 libwebp alsa-lib xz bzip2 zlib gmp gnutls ladspa libass
libbluray libdrm gsm libmodplug lame opencore-amr openjpeg2 opus speex x264 x265 xvidcore libavc1394 libx11
libtheora srt libiec61883 libvdpau libxext libxv libxcb")

build_deps=("${adddep} amf-headers avisynthplus clang ffnvcodec-headers ladspa mesa nasm opencl-headers vulkan-headers")

removedep=("avisynthplus intel-media-sdk ladspa nvidia-utils")

build(){
  go_src_dir
  burn_patches
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib \
    --disable-debug \
    --disable-static \
    --disable-stripping \
    --enable-libpulse \
    --enable-librsvg \
    --enable-libiec61883 \
    --enable-libxcb \
    --enable-libsrt \
    --enable-libjack \
    --enable-cuda-llvm \
    --enable-lto \
    --enable-fontconfig \
    --enable-gmp \
    --enable-gnutls \
    --enable-gpl \
    --enable-ladspa \
    --enable-libbluray \
    --enable-libdrm \
    --enable-libgsm \
    --enable-libfreetype \
    --enable-libfribidi \
    --enable-libmodplug \
    --enable-libmp3lame \
    --enable-libopencore_amrnb \
    --enable-libopencore_amrwb \
    --enable-libopenjpeg \
    --enable-libass \
    --enable-libspeex \
    --enable-libssh \
    --enable-libtheora \
    --enable-libopus \
    --enable-libvorbis \
    --enable-libwebp \
    --enable-libx264 \
    --enable-libx265 \
    --enable-libxml2 \
    --enable-shared \
    --enable-version3 \
    --enable-nvdec \
    --enable-nvenc \
    --enable-libxvid \
    --enable-libvpx \
    --enable-libv4l2 \
    --enable-libvidstab \
    --enable-libzimg \
    --enable-amf \
    --enable-libsvtav1 \
    --enable-libaom \
    --enable-libdav1d \
    --enable-librav1e \
    --enable-libvmaf \
    --enable-libmfx \
    --enable-nonfree \
    --enable-avisynth

#--enable-libsoxr

  make -j${numjobs}
  make tools/qt-faststart -j${numjobs}
  make doc/ff{mpeg,play}.1
  make DESTDIR=${pkgdir} install install-man

  install -Dm 755 tools/qt-faststart ${pkgdir}/usr/bin/
}
