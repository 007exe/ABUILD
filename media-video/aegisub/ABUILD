pkgname=aegisub
pkgver=3.3.3
pkgbuild=1
arch=("auto")
strict_version=1

shortdesc=("A general-purpose subtitle editor with ASS/SSA support.")

source=("git:https://github.com/wangqr/Aegisub.git")

tags=("apps media-video")

adddep=("alsa-lib boost-libs fftw fontconfig hunspell icu mesa libpulse uchardet wxwidgets-gtk3 zlib")

build_deps=("${adddep} boost cmake git mesa ninja")

# NOTE: Переходим к коммиту
# FIXME: mkpkg не умеет самостоятельно переключаться по веткам и коммитам
before_build() {
  go_src_dir
  git checkout ${_commit}
}

build() {
  go_src_dir
  burn_patches
  cmake -B build -G Ninja \
    -DCMAKE_BUILD_TYPE=None \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_INSTALL_LIBDIR=lib \
    -DWITH_OSS=OFF
  cmake --build build
  DESTDIR=${pkgdir} cmake --install build
  install -dm 755 ${pkgdir}/usr/share/aegisub/automation/include
  cp -dr --no-preserve=ownership automation/{autoload,demos} ${pkgdir}/usr/share/aegisub/automation/
  cp -dr --no-preserve=ownership automation/include/{aegisub,*.lua} ${pkgdir}/usr/share/aegisub/automation/include/
  install -Dm 644 LICENCE -t ${pkgdir}/usr/share/licenses/aegisub/
}
