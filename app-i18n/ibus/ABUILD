pkgname=ibus
pkglist=("lib")
pkgver=1.5.28
pkgbuild=1
arch=("auto")

shortdesc=("Next Generation Input Bus for Linux.")

source=("https://github.com/ibus/ibus/releases/download/${pkgver}/ibus-${pkgver}.tar.gz")

tags=("base app-i18n")

adddep=("hicolor-icon-theme dbus-python python-gobject")

build_deps=("${adddep} gobject-introspection vala intltool gnome-common gtk-doc gtk4 gtk2 qt5-base
unicode-cldr unicode-character-database unicode-emoj dconf gtk3 libnotify iso-codes librsvg")

lib(){
  pkgname=libibus
  shortdesc=("IBus support library")
  tags=("libs app-i18n")
}

build() {
  go_src_dir
  burn_patches
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib \
    --sysconfdir=/etc \
    --enable-dconf \
    --enable-wayland \
    --disable-gtk-doc \
    --enable-gtk4 \
    --disable-memconf \
    --enable-ui \
    --disable-systemd-services \
    --disable-python2 \
    --with-python=python3 \
    --with-ucd-dir=/usr/share/unicode/
  sed -i 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
  make -j${numjobs}
  make DESTDIR=${pkgdir} install
  make -C src DESTDIR=${pkgdir} uninstall
  make -C bindings DESTDIR=${pkgdir} uninstall
  make DESTDIR=${pkgdir} uninstall-pkgconfigDATA
}

lib_prep(){
  go_src_dir
  make -C src DESTDIR=${pkgdir} install
  make -C bindings DESTDIR=${pkgdir} install
  make DESTDIR=${pkgdir} install-pkgconfigDATA
}
