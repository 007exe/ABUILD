pkgname=sysklogd
pkgver=2.2.3
pkgbuild=1
arch=("auto")

shortdesc=("System logging and kernel message trapping daemons")
longdesc=("The sysklogd package contains two system utilities (syslogd and klogd) which provide support for system logging.  Syslogd and klogd run as daemons (background processes) and log system messages to different places, like sendmail logs, security logs, error logs, etc.")

tags=("app-admin base")

source=("https://github.com/troglobit/sysklogd/archive/refs/tags/v${pkgver}.tar.gz")

build_deps="glibc"

config_files="etc/conf.d/sysklogd
etc/logrotate.d/syslog
etc/syslog.conf"

build() {
  go_src_dir
  burn_patches
  ./autogen.sh
  ./configure \
    --prefix=/usr \
    --sbindir=/usr/bin \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --sysconfdir=/etc \
    --runstatedir=/run
  make -j${numjobs}
  make DESTDIR=${pkgdir} install

  install -D -m0755 ${filedir}/init.d/sysklogd ${pkgdir}/etc/init.d/sysklogd
  install -D -m0644 ${filedir}/conf.d/sysklogd ${pkgdir}/etc/conf.d/sysklogd
  install -D -m0644 ${filedir}/logrotate.d/syslog ${pkgdir}/etc/logrotate.d/syslog
  install -D -m0644 ${filedir}/syslog.conf ${pkgdir}/etc/syslog.conf
  mkdir -p ${pkgdir}/var/log

  for i in cron debug mail.log messages secure spooler syslog ;
        do touch ${pkgdir}/var/log/$i.new ;
  done
}

