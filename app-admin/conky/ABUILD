pkgname=conky
pkgver=1.12.2
pkgbuild=1
arch=("auto")

shortdesc=("Lightweight system monitor for X.")
longdesc=("An advanced, highly configurable system monitor for X.")

source=("https://github.com/brndnmtthws/conky/archive/v${pkgver}.tar.gz")

tags=("app-admin utils")

# -D BUILD_NVIDIA=ON libxnvctrl
build_deps=("cmake docbook-xsl man-db catch glibc glib2 lua wireless_tools
libxdamage libxinerama libxft imlib2 libxml2 libpulse ncurses curl docbook2x")

build(){
  go_src_dir
  burn_patches
# fix glibc 2.35
  rm -r tests/catch2
  ln -s /usr/include/catch2 tests
  cmake \
    -B build \
    -D CMAKE_BUILD_TYPE=Release \
    -D CMAKE_CXX_FLAGS="$CXXFLAGS -ffat-lto-objects" \
    -D MAINTAINER_MODE=ON \
    -D BUILD_DOCS=ON \
    -D BUILD_WLAN=ON \
    -D BUILD_XDBE=ON \
    -D BUILD_XSHAPE=ON \
    -D BUILD_IMLIB2=ON \
    -D BUILD_CURL=ON \
    -D BUILD_RSS=ON \
    -D BUILD_NVIDIA=OFF \
    -D BUILD_WEATHER_METAR=ON \
    -D BUILD_PULSEAUDIO=ON \
    -D BUILD_JOURNAL=ON \
    -D BUILD_AUDACIOUS=NO \
    -D BUILD_BUILTIN_CONFIG=YES \
    -D BUILD_I18N=YES \
    -D BUILD_OLD_CONFIG=YES \
    -D CMAKE_INSTALL_PREFIX=/usr \
    -Wno-dev \
    -S .
  make -C build -j${numjobs}
  make -C build DESTDIR=${pkgdir} install
  install -Dm 644 COPYING -t ${pkgdir}/usr/share/licenses/${pkgname}
  install -Dm 644 extras/vim/syntax/conkyrc.vim -t ${pkgdir}/usr/share/vim/vimfiles/syntax
  install -Dm 644 extras/vim/ftdetect/conkyrc.vim -t ${pkgdir}/usr/share/vim/vimfiles/ftdetect
}
