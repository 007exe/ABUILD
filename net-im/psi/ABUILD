pkgname=psi
pkglist=("psi-nowebengine")
pkgver=1.5
pkgbuild=1
arch=("auto")

shortdesc=("Powerful XMPP (Jabber) client (Qt, C++) designed for power users.")

source=("https://download.sourceforge.net/${pkgname}/${pkgname}-${pkgver}.tar.xz")

tags=("apps net-im")

# qca
build_deps=("cmake qt5-multimedia hunspell qt5-svg qt5-webengine qt5-x11extras libidn qca-qt5 qca-qt6")

# qca
adddep=("hunspell qt5-svg qt5-webengine qt5-x11extras libidn")

conflicts=("psi-nowebengine")

build() {
  go_src_dir
  burn_patches
  mkdir -p build
  cd build
  cmake .. \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_BUILD_TYPE=Release
  make -j${numjobs}
  make DESTDIR=${pkgdir} install

  install -dm755 ${pkgdir}/usr/include/psi/plugins
  install -m644 ../src/plugins/include/*.h ${pkgdir}/usr/include/psi/plugins
  install -Dm644 ../psi.appdata.xml ${pkgdir}/usr/share/metainfo/psi.appdata.xml
}


psi-nowebengine() {
  pkgname=psi-nowebengine
  shortdesc=("Powerful XMPP (Jabber) client (Qt, C++) designed for power users without WebEngine support.")
  adddep=("hunspell minizip qca-qt5 qt5-svg qt5-x11extras libidn")
  conflicts=("psi")
}

psi-nowebengine_prep() {
  go_src_dir
  mkdir -p build-nowebengine
  cd build-nowebengine
  cmake .. \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_BUILD_TYPE=Release \
    -DENABLE_WEBKIT=OFF
  make -j${numjobs} DESTDIR=${pkgdir} install
  install -dm755 ${pkgdir}/usr/include/psi/plugins
  install -m644 ../src/plugins/include/*.h ${pkgdir}/usr/include/psi/plugins

  echo 'X-AppStream-Ignore=true' >> ${pkgdir}/usr/share/applications/psi.desktop
}
