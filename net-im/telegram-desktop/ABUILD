pkgname=telegram-desktop
pkgver=4.6.3
pkgbuild=1
arch=("auto")

shortdesc=("Official Telegram Desktop client.")

#source=("https://github.com/telegramdesktop/tdesktop/releases/download/v${pkgver}/tdesktop-${pkgver}-full.tar.gz")
source=("https://updates.tdesktop.com/tlinux/tsetup.${pkgver}.tar.xz")

tags=("apps net-im")

#build_deps=("cmake ninja python range-v3 microsoft-gsl meson tl-expected
#extra-cmake-modules wayland-protocols plasma-wayland-protocols libtg_owt
#hunspell ffmpeg hicolor-icon-theme lz4 minizip openal ttf-opensans
#qt6-imageformats qt6-svg qt6-wayland qt6-5compat xxhash glibmm rnnoise
#pipewire libxtst libxrandr jemalloc abseil-cpp libdispatch openssl
#protobuf")

build_deps=("glibc libglvnd libx11 fontconfig freetype glib2 libxcb")

adddep=("hicolor-icon-theme ttf-opensans")

# NOTE: Это опциональные зависимости
removedep=("webkit2gtk xdg-desktop-portal")

build() {
  go_src_dir
  install -Dm755 Telegram ${pkgdir}/usr/bin/telegram-desktop
  install -Dm644 ${filedir}/telegramdesktop.desktop ${pkgdir}/usr/share/applications/telegramdesktop.desktop
  install -Dm644 ${filedir}/telegramdesktop.metainfo.xml ${pkgdir}/usr/share/metainfo/telegramdesktop.metainfo.xml
  mkdir -p ${pkgdir}/usr/share/icons
  cp -r ${filedir}/hicolor ${pkgdir}/usr/share/icons/
#  cmake -B build \
#    -DCMAKE_INSTALL_PREFIX="/usr" \
#    -DCMAKE_BUILD_TYPE=Release \
#    -DTDESKTOP_API_ID=611335 \
#    -DTDESKTOP_API_HASH=d524b414d21f4d37f08684c1df41ac9c
#    ninja -C build
#  DESTDIR=${pkgdir} ninja -C build install
}
