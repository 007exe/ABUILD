pkgname=ntp
pkgver=4.2.8p15
pkgbuild=1
arch=("auto")

shortdesc=("Network Time Protocol reference implementation")
longdesc=("The ntp package contains a client and server to keep the time synchronized between various computers over a network. This package is the official reference implementation of the NTP protocol.")

tags=("net-misc network")

source=("https://www.eecis.udel.edu/~ntp/ntp_spool/ntp4/ntp-4.2/ntp-${pkgver/p /.p}.tar.gz")

build_deps="openssl perl libcap libedit"

config_files="etc/ntp.conf
etc/conf.d/ntpd
etc/ntp-client.conf"

build() {
  go_src_dir
  burn_patches
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --enable-linuxcaps \
    --enable-ntp-signd \
    --sysconfdir=/etc \
    --enable-linuxcaps \
    --with-lineeditlibs=readline
  make -j${numjobs}
  make DESTDIR=${pkgdir} install

  install -D -m755 ${filedir}/ntpd.init ${pkgdir}/etc/init.d/ntpd
  install -D -m755 ${filedir}/ntp-client.init ${pkgdir}/etc/init.d/ntp-client

# install server configs
  install -D -m644 ${filedir}/ntp.conf $pkgdir/etc/ntp.conf
  install -D -m644 ${filedir}/ntpd.conf.d ${pkgdir}/etc/conf.d/ntpd

# install conf files
  mkdir -p "$pkgdir/usr/share/ntp"
  install -D -m644 conf/* "$pkgdir/usr/share/ntp/"

# install client configs
  install -D -m644 ${filedir}/ntp-client.conf ${pkgdir}/etc/ntp-client.conf
  install -D -m644 ${filedir}/ntp-client.conf.d ${pkgdir}/etc/conf.d/ntp-client

# create /var/lib/ntp
  mkdir -p "$pkgdir/var/lib/ntp"
  touch "$pkgdir/var/lib/ntp/.placeholder"

  install -Dm644 COPYRIGHT "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
