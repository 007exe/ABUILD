pkgname=rsync
pkgver=3.2.7
pkgbuild=1
arch=("auto")

shortdesc=("A program for synchronizing files over a network.")
longdesc=("Rsync uses a quick and reliable algorithm to very quickly bring remote and host files into sync.")

source=("https://github.com/WayneD/rsync/archive/refs/tags/v${pkgver}.tar.gz")

tags=("network net-misc")

build_deps=("acl lz4 openssl perl popt xxhash zlib zstd python-commonmark")

config_files=("etc/rsyncd.conf")

build() {
  go_src_dir
  burn_patches
  ./configure \
    --prefix=/usr \
    --disable-debug \
    --with-included-popt=no \
    --with-included-zlib=no
  make -j${numjobs}
  make DESTDIR=${pkgdir} install

  install -Dm0644 ${filedir}/rsyncd.conf ${pkgdir}/etc/rsyncd.conf
  install -Dm755 ${filedir}/rsyncd.init.d ${pkgdir}/etc/init.d/rsyncd
  install -Dm644 ${filedir}/rsyncd.conf.d ${pkgdir}/etc/conf.d/rsyncd.new
  install -Dm644 ${filedir}/rsyncd.logrotate ${pkgdir}/etc/logrotate.d/rsyncd
  install -Dm644 ${filedir}/rsyncd.conf ${pkgdir}/etc/rsyncd.conf.new
}
