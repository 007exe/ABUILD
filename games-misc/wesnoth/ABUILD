pkgname=wesnoth
pkgver=1.17.22
pkgbuild=1
arch=("auto")

shortdesc=("A turn-based strategy game on a fantasy world.")

source=("https://deac-riga.dl.sourceforge.net/project/wesnoth/wesnoth/wesnoth-${pkgver}/wesnoth-${pkgver}.tar.bz2")

tags=("games games-strategy")

adddep=("sdl2_mixer sdl2_image boost-libs pango dbus")

build_deps=("${adddep} boost cmake ninja")

build(){
  go_src_dir
  burn_patches
  cmake -GNinja -Bbuild \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_INSTALL_LIBDIR=lib \
    -DENABLE_TOOLS=ON \
    -DFIFO_DIR=/run/wesnothd \
    -DENABLE_DISPLAY_REVISION=OFF
  ninja -C build
  DESTDIR=${pkgdir} ninja -C build install
  echo "Linux repository" > "$pkgdir"/usr/share/wesnoth/data/dist

  mkdir -p "$pkgdir"/usr/lib/{tmpfiles.d,systemd/system}
  sed "s|@FIFO_DIR@|/run/wesnothd|" packaging/systemd/wesnothd.tmpfiles.conf.in > ${pkgdir}/usr/lib/tmpfiles.d/wesnothd.conf
  sed -e "s|@FIFO_DIR@|/run/wesnothd|" -e "s|@BINARY_SUFFIX@||" -e "s|@CMAKE_INSTALL_FULL_BINDIR@|/usr/bin|" packaging/systemd/wesnothd.service.in > ${pkgdir}/usr/lib/systemd/system/wesnothd.service
}

