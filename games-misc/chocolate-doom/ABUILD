pkgname=chocolate-doom
pkgver=3.0.1
pkgbuild=1
arch=("auto")

shortdesc=("Historically-accurate Doom, Heretic, Hexen, and Strife ports.")

source=("https://www.chocolate-doom.org/downloads/${pkgver}/${pkgname}-${pkgver}.tar.gz")

tags=("games games-action")

adddep=("libpng libsamplerate sdl2_mixer sdl2_net")

build_deps=("${adddep} python")

# NOTE: Это опциональные зависимости
removedep=("freedm freedoom1 freedoom2")

build() {
  go_src_dir
  burn_patches
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib
  make -j${numjobs}
  make DESTDIR=${pkgdir} install

  install -dm 755 ${pkgdir}/usr/share/games/doom

  rm ${pkgdir}/usr/bin/chocolate-{heretic,hexen,strife}-setup
  mv ${pkgdir}/usr/bin/chocolate-doom-setup ${pkgdir}/usr/bin/chocolate-setup
  ln -s chocolate-setup ${pkgdir}/usr/bin/chocolate-doom-setup
  ln -s chocolate-setup ${pkgdir}/usr/bin/chocolate-heretic-setup
  ln -s chocolate-setup ${pkgdir}/usr/bin/chocolate-hexen-setup
  ln -s chocolate-setup ${pkgdir}/usr/bin/chocolate-strife-setup
}
