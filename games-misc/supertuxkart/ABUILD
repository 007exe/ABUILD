pkgname=supertuxkart
pkgver=1.4
pkgbuild=1
arch=("auto")

shortdesc=("Kart racing game featuring Tux and his friends.")

source=("https://github.com/supertuxkart/stk-code/releases/download/${pkgver}/SuperTuxKart-${pkgver}-src.tar.xz")

tags=("games games-sports")

build_deps=("cmake setconf ninja openal libvorbis freetype harfbuzz curl bluez-libs sqlite libjpeg-turbo libpng hicolor-icon-theme sdl2 shaderc")

adddep=("openal libvorbis freetype harfbuzz curl bluez-libs sqlite libjpeg-turbo libpng hicolor-icon-theme sdl2 shaderc")

build() {
  go_src_dir
  burn_patches
  _fn=data/${pkgname}.desktop
  setconf ${_fn} Exec ${pkgname}
  setconf ${_fn} TryExec ${pkgname}
  setconf ${_fn} Icon ${pkgname}

  cmake -Bbuild \
    -GNinja \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_INSTALL_LIBDIR=lib \
    -DBUILD_RECORDER=0
  ninja -C build
  DESTDIR=${pkgdir} ninja -C build install

  rm -r ${pkgdir}/usr/lib
  rm -r ${pkgdir}/usr/include
}
