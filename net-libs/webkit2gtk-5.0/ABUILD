pkgname=webkit2gtk-5.0
pkgver=2.36.7
pkgbuild=1
arch=("auto")

shortdesc=("Web content engine for GTK.")
longdesc=("The WebKitGTK package is a port of the portable web rendering engine WebKit to the GTK+ 3 and GTK+ 2 platforms.")

source=("https://webkitgtk.org/releases/webkitgtk-${pkgver}.tar.xz")

tags=("libs net-libs")

build_deps=("cmake ninja python ruby gobject-introspection wayland-protocols gst-plugins-bad gperf
cairo fontconfig freetype libgcrypt glib2 gtk4 harfbuzz icu libjpeg-turbo libsoup3 libxml2 zlib
libpng sqlite atk libwebp at-spi2-core libglvnd mesa libwpe wpebackend-fdo libxslt libsecret
libtasn1 enchant libx11 libxext libice libxt wayland libnotify hyphen openjpeg2 woff2 bubblewrap
libseccomp xdg-dbus-proxy gstreamer gst-plugins-base-libs libmanette libxcomposite")

# NOTE: Это опциональные зависимости
removedep=("geoclue gst-plugins-good gst-plugins-bad gst-libav")

build() {
  go_src_dir
  burn_patches
  CFLAGS+=' -g1'
  CXXFLAGS+=' -g1'
  cmake -B build -G Ninja \
    -DPORT=GTK \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_INSTALL_LIBDIR=lib \
    -DCMAKE_SKIP_RPATH=ON \
    -DUSE_GTK4=ON \
    -DENABLE_GTKDOC=OFF \
    -DENABLE_MINIBROWSER=ON
  cmake --build build
  DESTDIR=${pkgdir} cmake --install build

  find Source -name 'COPYING*' -or -name 'LICENSE*' -print0 | sort -z |
    while IFS= read -d $'\0' -r _f; do
      echo "### $_f ###"
      cat "$_f"
      echo
    done |
    install -Dm644 /dev/stdin ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
}
