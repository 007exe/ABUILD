# ABUILD generated by mkpkg_generator.sh

pkgname=xpdf
pkgver=3.03
pkgbuild=1
arch=("auto")

shortdesc=("xpdf (PDF viewer for X)")
longdesc=("Xpdf is a viewer for Portable Document Format (PDF) files. xpdf was written by Derek B. Noonburg. The xpdf package requires the t1lib package to render Type 1 fonts.")

tags=("app-text xapps")

source=("ftp://ftp.foolabs.com/pub/${pkgname}/${pkgname}-${pkgver%_*}.tar.gz")
build_deps="glibc-solibs lesstif libICE libpthread-stubs libSM libX11 libXau libxcb libXdmcp libXext libXp libXpm libXt t1lib poppler lesstif"

before_build() {
  go_src_dir
  sed -i 's:/usr/share/fonts/type1/gsfonts:/usr/share/fonts/Type1:' xpdf/GlobalParams.cc
  sed -i 's:times-medium-r-normal--16:times-medium-r-normal--14:' xpdf/XPDFViewer.cc # FS#14217
}

BUILD_SYSTEM="autotools"
BUILD_KEYS="--prefix=/usr \
  --libdir=/usr/lib$LIBDIRSUFFIX \
  --mandir=/usr/man \
  --sysconfdir=/etc \
  --enable-multithreaded \
  --enable-wordlist \
  --with-freetype2-library=/usr/lib$LIBDIRSUFFIX \
  --with-freetype2-includes=/usr/include/freetype2 \
  --x-includes=/usr/include \
  --with-Xm-library=/usr/lib$LIBDIRSUFFIX \
  --with-Xm-includes=/usr/include"
INSTALL_KEYS="DESTDIR=$pkgdir"


after_build() {
  go_src_dir
  install -Dm644 xpdf/xpdfIcon.xpm "${pkgdir}/usr/share/pixmaps/xpdf.xpm"
  # stuff provided by poppler
  for tool in pdfdetach pdffonts pdfimages pdfinfo pdftoppm pdftops pdftotext; do
    rm "${pkgdir}/usr/bin/${tool}" "${pkgdir}/usr/man/man1/${tool}.1"
  done
}