pkgname=coreutils
pkgver=8.32
pkgbuild=6
arch=('auto')

shortdesc=("The GNU core utilities: a set of tools commonly used in shell scripts")
longdesc=("This package is the union of the old GNU fileutils, sh-utils, and textutils packages. These tools are the GNU versions of common useful and popular file & text utilities. Most of these programs have significant advantages over their Unix counterparts, such as greater speed, additional options, and fewer arbitrary limits.")

tags=("base sys-apps")

source=("http://ftp.gnu.org/gnu/coreutils/coreutils-${pkgver}.tar.xz")

config_files="etc/DIR_COLORS"

build_deps="acl attr gmp libcap openssl"

build() {
  go_src_dir
  burn_patches

# As we build within fakeroot, FORCE_UNSAFE_CONFIGURE should be set to 1
  FORCE_UNSAFE_CONFIGURE=1 \
  DEFAULT_POSIX2_VERSION=199209 \
  CFLAGS="$SLKCFLAGS" \
  ./configure \
    --prefix=/usr \
    --enable-no-install-program=groups,hostname,kill,uptime \
    --with-openssl \
    --sysconfdir=/etc
#--libexecdir=/usr/lib${LIBDIRSUFFIX} \
  make -j${numjobs} || make || exit 1
  make DESTDIR=${pkgdir} install

# Add some defaults, although a very slack-like set of default options are built
# into /bin/ls now anyway:
  mkdir -p $pkgdir/etc
  cp $filedir/DIR_COLORS $pkgdir/etc/DIR_COLORS

# Since dircolors no longer provides any default aliases these scripts
# will be needed for ls to act as expected:
  mkdir -p $pkgdir/etc/profile.d
  install -m755 $filedir/coreutils-dircolors.csh $pkgdir/etc/profile.d/coreutils-dircolors.csh
  install -m755 $filedir/coreutils-dircolors.sh $pkgdir/etc/profile.d/coreutils-dircolors.sh

# These are important enough that they should probably all go into /bin at this
# point...   Having some of them unavailable when /usr isn't mounted is just a
# source of unending bug reports for various third party applications.
# Time to end those reports.  :-)
  mkdir -p $pkgdir/bin
  ( cd $pkgdir/bin
    for file in ../usr/bin/* ; do
             ln --verbose -sf $file .
    done
  )
}
