# ABUILD generated by mkpkg_generator.sh

pkgname=glibc
pkgver=2.33
pkgbuild=1
arch=("auto")

shortdesc=("glibc (GNU C libraries)")
longdesc=("This package contains the GNU C libraries and header files. The GNU C library was written originally by Roland McGrath, and is currently maintained by Ulrich Drepper. Some parts of the library were contributed or worked on by other people. Your system ha.")

tags=("base sys-base")

source=("http://ftp.gnu.org/gnu/glibc/glibc-${pkgver}.tar.xz")

config_files="etc/nscd.conf"

build_deps="git python"

pkglist="glibc-solibs glibc-l18n"

before_build() {
	# glibc uses custom CFLAGS, specify them
	if [ "$ARCH" = "x86_64" ] ; then
		GLIBC_CFLAGS="-O3 -fPIC"
	else
		GLIBC_CFLAGS="-O3 -march=i686"
	fi
}

build() {
	go_src_dir
	burn_patches
	mkdir glibc_build
	cd glibc_build
	CGLAGS="${GLIBC_CFLAGS}"

	if [[ ${CARCH} = "i686" ]]; then
		# Hack to fix NPTL issues with Xen, only required on 32bit platforms
		export CFLAGS="${CFLAGS} -mno-tls-direct-seg-refs"
	fi

	export CFLAGS

	../configure \
	--prefix=/usr \
	--libdir=/usr/lib${LIBDIRSUFFIX} \
	--enable-kernel=4.4 \
	--with-headers=/usr/include \
	--enable-add-ons \
	--disable-profile \
	--infodir=/usr/share/info \
	--mandir=/usr/share/man \
	--enable-bind-now \
	--without-gd \
	--disable-multi-arch \
	--with-tls \
	--with-__thread \
	--without-cvs \
	$ARCH-slackware-linux

	make -j${numjobs} || make || exit 1
	make install install_root=${pkgdir} || exit 1
	mkdir -p ${startdir}/localepkg
	make localedata/install-locales install_root=${pkgdir} || exit 1

	# Now NOT provided by kernel-headers. Plz don't remove
	# rm ${pkgdir}/usr/include/scsi/scsi.h

	install -m644 $srcdir/glibc-${pkgver}/nscd/nscd.conf ${pkgdir}/etc/nscd.conf || exit 1
}


glibc-solibs() {
  pkgname=glibc-solibs
  tags=("virtual sys-libs")
  shortdesc=("glibc-solibs (GNU C libraries) - virtual package")
  longdesc=("The glibc-solibs virtual package SHOULD be REMOVED moved to the glibc package !!!!")
}

glibc-solibs_prep() {
	echo Make glibc-solibs package: done
}

glibc-l18n() {
  pkgname=glibc-l18n
  tags=("virtual sys-libs")
  shortdesc=("glibc-l18n (GNU C libraries) - virtual package")
  longdesc=("The glibc-l18n virtual package SHOULD be REMOVED moved to the glibc package !!!!")
}

glibc-l18n_prep() {
	echo Make glibc-l18n package: done
}

