pkgname=zstd
pkgver=1.5.0
pkgbuild=1
arch=("auto")

shortdesc="Extremely powerful file compression utility"
longdesc="Compression algorithm and implementation designed to scale with modern hardware and compress smaller and faster. Zstandard combines recent compression breakthroughs, like Finite State Entropy, with a performance-first design and then optimizes the implementation for the unique properties of modern CPUs."

tags=("base app-arch")

source=("https://github.com/facebook/zstd/releases/download/v${pkgver}/zstd-${pkgver}.tar.gz")

build_deps="mkpkg cmake"

build() {
  go_src_dir
  mkdir builds
  cd builds
  cmake -DZSTD_BUILD_CONTRIB:BOOL=ON \
    -DZSTD_LZMA_SUPPORT:BOOL=ON \
    -DZSTD_PROGRAMS_LINK_SHARED:BOOL=ON \
    -DZSTD_ZLIB_SUPPORT:BOOL=ON \
    -DZSTD_MULTITHREAD_SUPPORT:BOOL=ON \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_INSTALL_LIBDIR=lib${LIBDIRSUFFIX} \
    ../build/cmake
  make -j${numjobs}
  make DESTDIR=${pkgdir} install
  ln -sf /usr/bin/zstd "$pkgdir/usr/bin/zstdmt"
  install -Dm755 contrib/pzstd/pzstd "$pkgdir/usr/bin/pzstd"
  install -Dm644 ../LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
