# ABUILD generated by mkpkg_generator.sh

pkgname=linux-pam
pkgver=1.4.0
pkgbuild=1
arch=("auto")

shortdesc=("Pluggable Authentication Modules for Linux")
longdesc=("Pluggable Authentication Modules for Linux")

tags=("base sys-libs compat32")

build_deps="db libtirpc flex docbook-xml docbook-xsl cracklib libaudit"

config_files="etc/security/access.conf
etc/security/group.conf
etc/security/limits.conf
etc/security/namespace.conf
etc/security/namespace.init
etc/security/pam_env.conf
etc/security/time.conf
etc/security/faillock.conf
etc/environment
etc/pam.d/other
etc/pam.d/system-auth
etc/pam.d/system-local-login
etc/pam.d/system-login
etc/pam.d/system-remote-login
etc/pam.d/system-services"

source=("https://github.com/linux-pam/linux-pam/releases/download/v$pkgver/Linux-PAM-$pkgver.tar.xz")

build() {
	cd $srcdir/Linux-PAM-$pkgver
burn_patches
	./configure --prefix=/usr --sysconfdir=/etc \
	  --enable-sconfigdir=/etc/security \
	  --enable-securedir=/lib${LIBDIRSUFFIX}/security \
	  --libdir=/lib${LIBDIRSUFFIX} \
	  --sbindir=/sbin \
	  --disable-db \
	  --disable-prelude \
          --mandir=/usr/share/man \
	  --docdir=/usr/share/doc/${pkgname}-${pkgver} \
	  --disable-nis
	make -j${numjobs} || make
	make DESTDIR=$pkgdir SCONFIGDIR=/etc/security install

        chmod +s "$pkgdir"/sbin/unix_chkpwd

        # Until this stuff is not in other packages, let it provide from here:
        for i in ${filedir}/pam.d/* ; do
                install -D $i ${pkgdir}/etc/pam.d/`basename $i`
        done
        install -dm755 "$pkgdir/etc/pam.d"
}
