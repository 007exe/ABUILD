pkgname=pciutils
pkgver=3.7.0
pkgbuild=2
arch=("auto")

shortdesc=("PCI bus related utilities")
longdesc=("This package contains various utilities for inspecting and setting devices connected to the PCI bus.")

tags=("base sys-apps compat32")

source=("https://mj.ucw.cz/download/linux/pci/${pkgname}-${pkgver}.tar.gz")

build_deps="kmod glibc"

build() {
  go_src_dir
  burn_patches
  ./update-pciids.sh
  make OPT="${CFLAGS} ${SLKCFLAGS} -fPIC -DPIC" ZLIB=no SHARED=no PREFIX=/usr SBINDIR=/usr/bin LIBDIR=/usr/lib${LIBDIRSUFFIX} SHAREDIR=/usr/share MANDIR=/usr/share/man all -j${numjobs}
  cp lib/libpci.a ${srcdir}/
  make clean
  make OPT="${CFLAGS} ${SLKCFLAGS}" ZLIB=no SHARED=yes PREFIX=/usr SBINDIR=/usr/bin LIBDIR=/usr/lib${LIBDIRSUFFIX} SHAREDIR=/usr/share MANDIR=/usr/share/man all -j${numjobs}
  make SHARED=yes PREFIX=/usr SBINDIR=/usr/bin SHAREDIR=/usr/share MANDIR=/usr/share/man LIBDIR=/usr/lib${LIBDIRSUFFIX} DESTDIR=${pkgdir} install install-lib
  install -m644 ${srcdir}/libpci.a ${pkgdir}/usr/lib${LIBDIRSUFFIX}/
}
