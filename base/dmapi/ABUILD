# ABUILD generated by mkpkg_generator.sh

pkgname=dmapi
pkgver=2.2.12
pkgbuild=1
arch=("auto")

shortdesc=("dmapi (Data Management API library)")
longdesc=("A library required to use the Data Management API (DMAPI). This interface is defined in the X/Open document 'Systems Management: Data Storage Managment (XDSM) API' dated February 1997. The DMAPI library is used by the xfsdump utility.")

tags=("base sys-apps")

source=("https://sources.archlinux.org/other/packages/dmapi/$pkgname-$pkgver.tar.gz")

build_deps="glibc-solibs xfsprogs autoconf"


build() {
  go_src_dir
  burn_patches
  [ "$CARCH" = "x86_64" ] && export CFLAGS="$CLFAGS -fPIC"
  export INSTALL_USER=root
  export INSTALL_GROUP=root
  export DEBUG=-DNDEBUG
  autoconf
  ./configure --prefix=/usr --libdir=/usr/lib$LIBDIRSUFFIX --libexecdir=/usr/lib$LIBDIRSUFFIX --docdir=/usr/share/doc/${pkgname}-${pkgver}
  make
}

after_build() {
  go_src_dir
  make DIST_ROOT=$pkgdir install install-dev
  # the static lib
  install -D -m644 libdm/.libs/libdm.a $pkgdir/usr/lib$LIBDIRSUFFIX/libdm.a
  # and the header file, please
  install -D -m644 include/dmapi.h $pkgdir/usr/include/xfs/dmapi.h
}
