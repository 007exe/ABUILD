pkgname=glibc
pkgver=2.34
pkgbuild=1
arch=("auto")

shortdesc=("The GNU libc libraries")
longdesc=("The glibc package contains standard libraries which are used by multiple programs on the system. In order to save disk space and memory, as well as to make upgrading easier, common system code is kept in one place and shared between programs. This particular package contains the most important sets of shared libraries: the standard C library and the standard math library. Without these two libraries, a Linux system will not function.")

tags=("base sys-base")

source=("http://ftp.gnu.org/gnu/glibc/glibc-${pkgver}.tar.xz")

config_files="etc/nscd.conf"

build_deps="gd python"

build() {
  go_src_dir
  burn_patches
  mkdir glibc_build
  cd glibc_build

  ../configure \
    --prefix=/usr \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --with-headers=/usr/include \
    --mandir=/usr/share/man \
    --infodir=/usr/share/info \
    --enable-kernel=4.4 \
    --enable-add-ons \
    --disable-profile \
    --enable-bind-now \
    --without-gd \
    --enable-multi-arch \
    --with-tls \
    --with-__thread \
    --without-cvs

  make -j${numjobs} || make || exit 1
  make install install_root=${pkgdir} || exit 1
  mkdir -p ${startdir}/localepkg
  make localedata/install-locales install_root=${pkgdir} || exit 1

  install -m644 $srcdir/glibc-${pkgver}/nscd/nscd.conf ${pkgdir}/etc/nscd.conf || exit 1
}
