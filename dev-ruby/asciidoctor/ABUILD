pkgname=asciidoctor
pkgver=2.0.15
pkgbuild=1
arch=("auto")

shortdesc="Tool to convert AsciiDoc(tor) text files to DocBook, HTML or Unix man pages"
longdesc="AsciiDoctor is a text document format for writing short documents, articles, books and UNIX man pages."

tags=("dev-ruby develop")

source=("https://rubygems.org/downloads/${pkgname}-${pkgver}.gem")

build_deps="ruby ruby-docs"

build() {
# Since mkpkg unpacks * .gem files, we copy them manually
  cp ${srcache}/${pkgname}-${pkgver}.gem .
  local _gemdir="$(ruby -e 'puts Gem.default_dir')"
  gem install --ignore-dependencies --verbose \
        -i "$pkgdir/$_gemdir" -n "$pkgdir/usr/bin" \
        "$pkgname-$pkgver.gem"
  install -Dm644 "$pkgdir/$_gemdir/gems/$pkgname-$pkgver/LICENSE" \
        "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
  install -Dm644 "$pkgdir/$_gemdir/gems/$pkgname-$pkgver/man/asciidoctor.1" \
        "$pkgdir/usr/share/man/man1/asciidoctor.1"
  rm "$pkgdir/$_gemdir/cache/$pkgname-$pkgver.gem"
  rm -rf "$pkgdir/$_gemdir/gems/$pkgname-$pkgver/man"
}
