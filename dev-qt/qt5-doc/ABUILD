pkgname=qt5-doc
pkgver=5.15.4
strict_version=1
pkgbuild=1
arch=("noarch")

shortdesc=("A cross-platform application and UI framework (Documentation).")
longdesc=("A cross-platform application and UI framework (Documentation).")

tags=("qt5 dev-qt")

source=("git:https://invent.kde.org/qt/qt/qtbase")

build_deps=("qt5-tools python pciutils libxtst libxcursor libxrandr libxss libxcomposite gperf nss clang nodejs")

adddep=("qt5-base")

pkglist=("qt5-examples")

before_build() {
  go_src_dir
  git checkout v${pkgver}-lts-lgpl

#  ln -s /usr/bin qttools/
  ln -s /usr/bin/{rcc,uic,moc,qmake} bin/
}

build() {
  go_src_dir
  burn_patches
  ./configure -confirm-license -opensource \
    -prefix /usr \
    -docdir /usr/share/doc/qt \
    -headerdir /usr/include/qt \
    -archdatadir /usr/lib/qt \
    -datadir /usr/share/qt \
    -sysconfdir /etc/xdg \
    -nomake examples
  make docs
  make INSTALL_ROOT=${pkgdir} install_docs

  install -d ${pkgdir}/usr/share/licenses
  ln -s /usr/share/licenses/qt5-base ${pkgdir}/usr/share/licenses/${pkgname}
}

qt5-examples() {
  pkgname=qt5-examples_pkgname1
  shortdesc=("Examples and demos from qt5 documentation.")
  longdesc=("Examples and demos from qt5 documentation.")
  adddep=("qt5-doc")
}

qt5-examples_prep() {
  go_src_dir
# Различные каталоги примеров содержат конфликтующие файлы .pro, но
# QtCreator требует, чтобы они находились в одном каталоге верхнего уровня.
# В соответствии с установщиком Qt5 сохраняется только проект qtbase.
  ${p_pkgdir}
  mkdir -p ${pkgdir}/usr/share/doc/qt/examples
  cp qtbase/examples/examples.pro ${pkgdir}/usr/share/doc/qt/examples
}
