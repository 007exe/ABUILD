pkgname=xl2tpd
pkgver=1.3.16
pkgbuild=1
arch=('auto')

shortdesc=("Layer 2 Tunnelling Protocol Daemon (RFC 2661)")
longdesc=("xl2tpd is an implementation of the Layer 2 Tunnelling Protocol (RFC 2661). L2TP allows you to tunnel PPP over UDP. Some ISPs use L2TP to tunnel user sessions from dial-in servers (modem banks, ADSL DSLAMs) to back-end PPP servers. Another important application is Virtual Private Networks where the IPsec protocol is used to secure the L2TP connection (L2TP/IPsec, RFC 3193). The L2TP/IPsec protocol is mainly used by Windows and Mac OS X clients. On Linux, xl2tpd can be used in combination with IPsec implementations such as Openswan.")

source=("https://github.com/xelerance/${pkgname}/archive/v${pkgver}.tar.gz")

tags="network app-admin"

build_deps="ppp"

adddep="ppp"

config_files="etc/xl2tpd/xl2tpd.conf
etc/ppp/options.xl2tpd
etc/xl2tpd/l2tp-secrets
etc/ppp/ip-up.vl
etc/ppp/ip-down.vl
etc/ppp/options.vl
etc/xl2tpd/xl2tpd.conf.vl"

build(){
  go_src_dir
  make DFLAGS=" -g -DDEBUG_PPPD -DDEBUG_CONTROL -DDEBUG_ENTROPY -DTRUST_PPPD_TO_DIE" PREFIX=/usr SBINDIR=/usr/bin KERNELSRC=/usr/src/linux-`uname -r` -j${numjobs}

  make PREFIX=/usr SBINDIR=/usr/bin SBINDIR="$pkgdir"/usr/bin KERNELSRC=/usr/src/linux-`uname -r` DESTDIR=$pkgdir MANDIR=$pkgdir/usr/share/man install

  install -p -D -m644 examples/xl2tpd.conf $pkgdir/etc/xl2tpd/xl2tpd.conf
  install -p -D -m644 examples/ppp-options.xl2tpd $pkgdir/etc/ppp/options.xl2tpd
  install -p -D -m600 doc/l2tp-secrets.sample $pkgdir/etc/xl2tpd/l2tp-secrets
  install -p -D -m600 examples/chapsecrets.sample $pkgdir/etc/ppp/chap-secrets.sample

  cp $filedir/ppp/ip-up.vl $pkgdir/etc/ppp
  cp $filedir/ppp/ip-down.vl $pkgdir/etc/ppp
  cp $filedir/ppp/options.vl $pkgdir/etc/ppp
  cp $filedir/xl2tpd/xl2tpd.conf.vl $pkgdir/etc/xl2tpd

  install -D -m0755 $filedir/xl2tpd.init $pkgdir/etc/init.d/xl2tpd
}
