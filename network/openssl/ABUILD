pkgname=openssl
pkgver=1.1.1k
pkgbuild=1
arch=('auto')

shortdesc="Secure Sockets Layer toolkit"
longdesc="The OpenSSL certificate management tool and the shared libraries that provide various encryption and decryption algorithms and protocols. This product includes software developed by the OpenSSL Project for use in the OpenSSL Toolkit (http://www.openssl.org). This product includes cryptographic software written by Eric Young (eay@cryptsoft.com). This product includes software written by Tim Hudson (tjh@cryptsoft.com)."

tags=('dev-libs network compat32')

source=("http://www.openssl.org/source/openssl-${pkgver}.tar.gz")

build_deps='make gcc glibc perl kernel-headers diffutils ca-certificates'

pkglist="solibs"

adddep="openssl-solibs==${pkgver}"

build() {
  go_src_dir
  burn_patches

	./Configure --prefix=/usr \
		--openssldir=/etc/ssl \
		--libdir=lib${LIBDIRSUFFIX} shared no-ssl3-method enable-ec_nistp_64_gcc_128 linux-x86_64 "-Wa,--noexecstack ${CPPFLAGS} ${CFLAGS} ${LDFLAGS}"
	make depend
	make
	make DESTDIR=$pkgdir MANDIR=/usr/share/man MANSUFFIX=ssl install_sw install_ssldirs install_man_docs

  # Создаю линки на libssl.so и libcrypto.so хз правельно или не правельно это но при сборке mpkg последний упорно ссылается на libssl.so.0 и libcrypto.so.0 в будущем нужно будит это удалить
  ln -n ${pkgdir}/usr/lib${LIBDIRSUFFIX}/libssl.so ${pkgdir}/usr/lib${LIBDIRSUFFIX}/libssl.so.0 
  ln -n ${pkgdir}/usr/lib${LIBDIRSUFFIX}/libcrypto.so ${pkgdir}/usr/lib${LIBDIRSUFFIX}/libcrypto.so.0 

  ln -n ${pkgdir}/usr/lib${LIBDIRSUFFIX}/libssl.so ${pkgdir}/usr/lib${LIBDIRSUFFIX}/libssl.so.1.0.0
  ln -n ${pkgdir}/usr/lib${LIBDIRSUFFIX}/libcrypto.so ${pkgdir}/usr/lib${LIBDIRSUFFIX}/libcrypto.so.1.0.0
  zcat $filedir/doinst.sh-openssl-solibs.gz > install/doinst.sh
}

solibs() {
  pkgname=openssl-solibs
  tags="sys-base base"
  shortdesc="This is a virtual package serving for compatibility, it should be removed. "
  longdesc="This is a virtual package serving for compatibility, it should be removed."
}

solibs_prep() {
  echo Make runtime package: done
}

