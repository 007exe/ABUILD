pkgname=dhcpcd
pkgver=9.4.0
pkgbuild=2
arch=('auto')

shortdesc=("DHCP Client Daemon")
longdesc=("Dhcpcd is an RFC2131 compliant DHCP client. It is fully featured and yet lightweight: the binary is 60k as reported by size(1) on Linux i386. It has support for duplicate address detection, IPv4LL, carrier detection, and a merged resolv.conf and ntp.conf for which other DHCP clients require third party tools.")

source=("http://roy.marples.name/downloads/${pkgname}/${pkgname}-${pkgver}.tar.xz")

tags="network net-misc"

config_files="etc/dhcpcd.conf
etc/conf.d/dhcpcd"

build_deps="glibc bash eudev"

adddep="bash"

build() {
  go_src_dir
  burn_patches
  ./configure \
    --prefix=/usr \
    --sbindir=/usr/bin \
    --sysconfdir=/etc \
    --localstatedir=/var \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --libexecdir=/usr/lib${LIBDIRSUFFIX}/dhcpcd \
    --dbdir=/usr/lib${LIBDIRSUFFIX}/dhcpcd \
    --rundir=/run \
    --disable-static \
    --mandir=/usr/share/man
  make -j${numjobs}
  make DESTDIR=${pkgdir} install
}

after_build(){
  go_src_dir

#Patch config for MS static routes on default
  sed -i 's/option classless_static_routes/# Obtain from server and write in routing table MS classless static routes.\
option ms_classless_static_routes/' ${pkgdir}/etc/dhcpcd.conf

# Disable IPV4LL
  echo noipv4ll >> ${pkgdir}/etc/dhcpcd.conf

# Install License
  install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"

# Set Options in /etc/dhcpcd.conf
  echo noipv4ll >> "${pkgdir}/etc/dhcpcd.conf" # Disable ip4vall

# Copy OpenRC scripts
  mkdir -p ${pkgdir}/etc/{conf.d,init.d}
  install -m0755 ${filedir}/dhcpcd.initd ${pkgdir}/etc/init.d/dhcpcd
  install -m0644 ${filedir}/dhcpcd.confd ${pkgdir}/etc/conf.d/dhcpcd
}
