# ABUILD generated by mkpkg_generator.sh

pkgname=tcp_wrappers
pkgver=7.6
pkgbuild=2
arch=("auto")

shortdesc=("tcp_wrappers (TCP/IP daemon wrapper library and utilities)")
longdesc=("With this package you can monitor and filter incoming requests for network services for access control, and detection things like host name spoofing and host address spoofing. Nearly all the network daemons on Slackware are "wrapped" using this library, and most daemons in /etc/inetd.conf use tcp_wrappers' tcpd wrapper daemon. If you plan to do much networking, you will need tcp_wrappers. tcp_wrappers was written by Wietse Venema.")

tags=("sys-apps network")
source=("ftp://ftp.porcupine.org/pub/security/${pkgname}_${pkgver}.tar.gz")

build_deps="glibc-solibs"
docs="BLURB DISCLAIMER"

build() {
  go_src_dir
  burn_patches
  local myconf="-DHAVE_WEAKSYMS -DINET6=1 -Dss_family=__ss_family -Dss_len=__ss_len"

  make \
	REAL_DAEMON_DIR=/usr/sbin \
	GENTOO_OPT="${myconf}" \
	MAJOR=0 MINOR=${pkgver:0:1} REL=${pkgver:2:3} \
	config-check || die "emake config-check failed"

  make -j${numjobs} \
	REAL_DAEMON_DIR=/usr/sbin \
	GENTOO_OPT="${myconf}" \
	MAJOR=0 MINOR=${pkgver:0:1} REL=${pkgver:2:3} \
	linux || die "emake linux failed"
}

after_build() {

  go_src_dir
  mkdir -p ${pkgdir}/usr/sbin
  install -m755 tcpd tcpdchk tcpdmatch safe_finger try-from ${pkgdir}/usr/sbin

  mkdir -p ${pkgdir}/usr/man/man{3,5,8}
  install -p -m644 hosts_access.3 ${pkgdir}/usr/man/man3
  install -p -m644 hosts_access.5 hosts_options.5 ${pkgdir}/usr/man/man5
  install -p -m644 tcpd.8 tcpdchk.8 tcpdmatch.8 ${pkgdir}/usr/man/man8

  ln -sf hosts_access.5 ${pkgdir}/usr/man/man5/hosts.allow.5
  ln -sf hosts_access.5 ${pkgdir}/usr/man/man5/hosts.deny.5

  install -D -m644 tcpd.h ${pkgdir}/usr/include/tcpd.h

  mkdir -p ${pkgdir}/usr/lib${LIBDIRSUFFIX}/
  cp -a libwrap.a ${pkgdir}/usr/lib${LIBDIRSUFFIX}/

  cp libwrap.so ${pkgdir}/usr/lib${LIBDIRSUFFIX}/libwrap.so.0.${pkgver}
  ln -s libwrap.so.0.${pkgver} ${pkgdir}/usr/lib${LIBDIRSUFFIX}/libwrap.so.0
  ln -s libwrap.so.0.${pkgver} ${pkgdir}/usr/lib${LIBDIRSUFFIX}/libwrap.so
}
