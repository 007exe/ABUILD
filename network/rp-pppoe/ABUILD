# ABUILD generated by mkpkg_generator.sh

pkgname=rp-pppoe
pkgver=3.14
pkgbuild=1
arch=("auto")

shortdesc=("Roaring Penguin PPPoE client")
longdesc=("Roaring Penguin's Point-to-Point Protocol over Ethernet client")

tags=("network net-dialup")

source=("https://dianne.skoll.ca/projects/rp-pppoe/download/rp-pppoe-$pkgver.tar.gz")
build_deps="ppp"

adddep="ppp>=2.4.7"
config_files="etc/ppp/pppoe.conf
etc/ppp/firewall-standalone
etc/ppp/firewall-masq
etc/ppp/pppoe-server-options"


build() {
	cd $srcdir/$pkgname-$pkgver/src
	burn_patches
	set -e
	CFLAGS="$SLKCFLAGS" CXXFLAGS="$SLKCFLAGS" ./configure --prefix=/usr --sbindir=/usr/bin --enable-plugin --libdir=/usr/lib${LIBDIRSUFFIX}
	make PLUGIN_DIR="/usr/lib/rp-pppoe" all rp-pppoe.so
	make -j${numjobs}
	set +e
	make DESTDIR=$pkgdir install
  
	mkdir -p ${pkgdir}/usr/lib${LIBDIRSUFFIX}/rp-pppoe
	mv ${pkgdir}/etc/ppp/plugins/rp-pppoe.so ${pkgdir}/usr/lib${LIBDIRSUFFIX}/rp-pppoe/
	#not necessary after moving the plugin
	rm -rf ${pkgdir}/etc/ppp/plugins
	#changing config to the new path
	sed -i 's/LINUX_PLUGIN=\/etc\/ppp\/plugins\/rp-pppoe.so/LINUX_PLUGIN=\/usr\/lib'${LIBDIRSUFFIX}'\/rp-pppoe\/rp-pppoe.so/g' ${pkgdir}/etc/ppp/pppoe.conf
}

