pkgname=iproute2
pkgver=5.12.0
pkgbuild=1
arch=("auto")

shortdesc="Advanced IP routing and network device configuration tools"
longdesc="These are tools used to administer many advanced IP routing features in the kernel. See Configure.help in the kernel documentation (search for iproute2) for more information on which kernel options these tools are used with. These utilities were written by Alexey Kuznetsov. The current maintainer of iproute2 is Stephen Hemminger."

tags=("sys-apps network")

source=("http://www.kernel.org/pub/linux/utils/net/${pkgname}/${pkgname}-${pkgver}.tar.xz")

build_deps="make gcc glibc flex iptables"

config_files="etc/iproute2/ematch_map
etc/iproute2/rt_dsfield
etc/iproute2/rt_protos
etc/iproute2/rt_realms
etc/iproute2/rt_scopes
etc/iproute2/rt_tables"

build() {
  go_src_dir

# do not treat warnings as errors
  sed -i 's/-Werror//' Makefile

  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib$LIBDIRSUFFIX
  make -j${numjobs}
  make DESTDIR="${pkgdir}" LIBDIR=/usr/lib$LIBDIRSUFFIX SBINDIR="/usr/bin" install

# libnetlink isn't installed, install it FS#19385
  install -Dm644 include/libnetlink.h ${pkgdir}/usr/include/libnetlink.h
  install -Dm644 lib/libnetlink.a ${pkgdir}/usr/lib$LIBDIRSUFFIX/libnetlink.a
}
