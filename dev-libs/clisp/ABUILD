pkgname=clisp
pkgver=2.49.93
# NOTE: Комит версии
_commit=de01f0f47bb44d3a0f9e842464cf2520b238f356
pkgbuild=1
arch=("auto")

shortdesc=("ANSI Common Lisp interpreter, compiler and debugger.")
longdesc=("GNU Clisp is a Common Lisp implementation which includes an interpreter, compiler, debugger, and many extensions.")

source=("https://gitlab.com/gnu-clisp/clisp/-/archive/${_commit}/clisp-${_commit}.tar.bz2")

tags=("develop dev-libs")

build_deps=("readline libsigsegv ffcall libunistring")

build(){
  go_src_dir
  burn_patches
  CFLAGS+=" -ffat-lto-objects" \
# NOTE: Обход ограничений сборки от root поскольку мы используем fakeroot
  export FORCE_UNSAFE_CONFIGURE=1
  ./configure \
    --prefix=/usr \
    --with-readline \
    --with-ffcall src
  cd src
  ./makemake \
    --prefix=/usr \
    --with-readline \
    --with-ffcall \
    --with-dynamic-ffi > Makefile
  make -j${numjobs}
  make DESTDIR=${pkgdir} install
}
