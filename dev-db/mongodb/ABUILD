# ABUILD generated by mkpkg_generator.sh

pkgname=mongodb
pkgver=2.6.0
pkgbuild=1
arch=("auto")

shortdesc=("Document-oriented schema-free NoSQL database")

tags=("server dev-db")

source=("http://downloads.mongodb.org/src/mongodb-src-r${pkgver}.tar.gz")

build_deps="scons boost readline ncurses openssl snappy pcre gperf"
config_files="etc/mongodb.conf
etc/conf.d/mongodb"

build() {
	MAKEFLAGS="${MAKEFLAGS} -j${numjobs}"
	export SCONSFLAGS="$MAKEFLAGS"
	go_src_dir
	burn_patches

	scons all \
		--use-system-boost \
		--use-system-pcre \
		--use-system-snappy \
		--ssl \
		--sharedclient

	scons install \
		--use-system-boost \
		--use-system-pcre \
		--use-system-snappy \
		--ssl \
		--sharedclient \
		--full \
		--prefix="$pkgdir/usr"

	install -Dm0644 ${filedir}/mongodb.conf ${pkgdir}/etc/mongodb.conf
	install -Dm0644 ${filedir}/mongodb.confd ${pkgdir}/etc/conf.d/mongodb
	install -Dm0755 ${filedir}/mongodb.initd ${pkgdir}/etc/init.d/mongodb

	install -dm700 "$pkgdir/var/lib/mongodb"
	install -dm755 "$pkgdir/var/log/mongodb"


#	# Fix libdir on x86_64 on a hard way
#	if [ "$LIBDIRSUFFIX" == "64" ] ; then
#		mv ${pkgdir}/usr/lib ${pkgdir}/usr/lib64
#	fi
}

