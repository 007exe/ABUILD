pkgname=zita-resampler
pkgver=1.8.0
pkgbuild=1
arch=('auto')

shortdesc=("A C++ library for resampling audio signals")
longdesc=("C++ library for real-time resampling of audio signals")

source=("https://kokkinizita.linuxaudio.org/linuxaudio/downloads/${pkgname}-${pkgver}.tar.bz2")

tags="libs media-libs"

build_deps=("libsndfile gcc-libs glibc")

build() {
  go_src_dir
  burn_patches
# FS#36248 - strip march=native
  sed -e '/native/d' -i {source,apps}/Makefile
# removing local call to ldconfig
  sed -e 's/ldconfig/& -N $(DESTDIR)\/$(LIBDIR)/' -i source/Makefile
# fix use of BINDIR without preceeding DESTDIR
# fix use of MANDIR without preceeding DESTDIR
  sed -e 's/\ $(BINDIR)/\ $(DESTDIR)$(BINDIR)/' -e 's/\ $(MANDIR)/\ $(DESTDIR)$(MANDIR)/' -i apps/Makefile
# libs
  make -C source
# create lib link for building apps
  ln -sv "lib${pkgname}.so.${pkgver}" "source/lib${pkgname}.so"
# apps
  make LDFLAGS+=" -L../source" CXXFLAGS+=" -I../source" -C apps
# cleanup link
  rm -rv "source/lib${pkgname}.so"
  make -C source DESTDIR="$pkgdir/" PREFIX=/usr LIBDIR=/usr/lib$LIBDIRSUFFIX SUFFIX="" install
  make -C apps DESTDIR="$pkgdir/" PREFIX=/usr LIBDIR=/usr/lib$LIBDIRSUFFIX install
# docs
  install -vDm 644 {AUTHORS,README} docs/* -t "${pkgdir}/usr/share/doc/${pkgname}"
}
