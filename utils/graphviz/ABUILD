pkgname=graphviz
pkgver=2.49.1
pkgbuild=1
arch=('auto')

shortdesc=("Graph visualization software")
longdesc=("The Graphviz package contains graph visualization software. Graph visualization is a way of representing structural information as diagrams of abstract graphs and networks. Graphviz has several main graph layout programs. It also has web and interactive graphical interfaces, auxiliary tools, libraries, and language bindings.")

source=("https://gitlab.com/graphviz/graphviz/-/archive/$pkgver/$pkgname-$pkgver.tar.gz")

tags="utils media-gfx"
# mono guile lua r tk qt5-base
build_deps="swig ocaml>=4.12.0 perl python gtk2 ghostscript"

adddep="ghostscript"

build() {
  go_src_dir
  burn_patches
  ./autogen.sh NOCONFIG
  export LIBPOSTFIX=/
  export CXXFLAGS+=' -fPIC -fpermissive'
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --enable-python3=yes \
    --disable-python
  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool # Fix overlinking
  make -j${numjobs}
  make DESTDIR=${pkgdir} install

# fix symlink to symlink that doesn't get picked up by makepkg's zipman
  ln -s gv2gxl.1.gz "${pkgdir}"/usr/share/man/man1/dot2gxl.1.gz
  rm "${pkgdir}"/usr/share/man/man1/dot2gxl.1

# Deduplicates TCL libraries
#  cd "${pkgdir}/usr/lib${LIBDIRSUFFIX}/tcl8.6"
#  rm -fr graphviz
#  ln -s ../graphviz/tcl graphviz
}
