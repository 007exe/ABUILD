pkgname=subversion
pkgver=1.14.1
pkgbuild=1
arch=('auto')

shortdesc=("A Modern Concurrent Version Control System")
longdesc=("Subversion is a version control system that is designed to be a compelling replacement for CVS in the open source community. It extends and enhances CVS' feature set, while maintaining a similar interface for those already familiar with CVS.")

tags=('dev-util develop')

source=("https://www.apache.org/dist/subversion/subversion-${pkgver}.tar.bz2")
# libutf8proc serf apache python-py3c java-environment libgnome-keyring kwallet kdelibs4support
build_deps="file sqlite python perl swig ruby"

config_files="etc/conf.d/svnserve"

build() {
  go_src_dir
  burn_patches
  ./autogen.sh
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --enable-shared \
    --disable-static \
    --with-apr-util=/usr/bin/apu-1-config \
    --with-apxs=/usr/sbin/apxs \
    --with-zlib \
    --with-pic
  make LT_LDFLAGS="-L$Fdestdir/usr/lib${LIBDIRSUFFIX}"
  make swig_pydir=/usr/lib/python3.9/site-packages/libsvn swig_pydir_extra=/usr/lib/python3.9/site-packages/svn swig-py swig-pl javahl swig-rb
  make DESTDIR=${pkgdir} INSTALLDIRS=vendor \
     swig_pydir=/usr/lib/python3.9/site-packages/libsvn \
     swig_pydir_extra=/usr/lib/python3.9/site-packages/svn \
     install install-swig-py install-swig-pl install-javahl install-swig-rb

  install -dm755 ${pkgdir}/usr/share/subversion
   cp -a tools/hook-scripts ${pkgdir}/usr/share/subversion/
   rm ${pkgdir}/usr/share/subversion/hook-scripts/*.in

# ... common config
  install -D -m 644 ${filedir}/svnserve.conf ${pkgdir}/etc/conf.d/svnserve

  install -Dm 644 tools/client-side/bash_completion \
     "${pkgdir}"/usr/share/bash-completion/completions/subversion
   for i in svn svnadmin svndumpfilter svnlook svnsync svnversion; do
      ln -sf subversion "${pkgdir}"/usr/share/bash-completion/completions/${i}
   done

# OpenRC scripts for svnserve
  install -Dm755 ${filedir}/svnserve.initd ${pkgdir}/etc/init.d/svnserve
}
