pkgname=git-cola
pkgver=4.3.2
pkgbuild=1
arch=("auto")

shortdesc=("The highly caffeinated Git GUI.")

source=("https://github.com/git-cola/git-cola/archive/v${pkgver}.tar.gz")

tags=("apps dev-util")

adddep=("git hicolor-icon-theme python-importlib-metadata python-numpy python-polib python-pyqt5 python-qtpy")

build_deps=("${adddep} python-build python-installer python-jaraco.packaging python-rst.linker python-setuptools-scm python-sphinx python-wheel")

# NOTE: Удаляем исходники пакета после сборки
# FIXME: mkpkg не умеет сохранять скачанные файлы под новыми именами, что может приводить к
# ошибкам когда в кеше имеется архив с исходниками от другого пакета с тем же именем
before_build(){
  go_src_dir
  rm -f ${srcache}/v${pkgver}.tar.gz
}

build() {
  go_src_dir
  burn_patches
  python -m build --wheel --no-isolation
  make prefix=/usr man
  python -m installer --destdir=${pkgdir} dist/*.whl
  make prefix=/usr DESTDIR=${pkgdir} install-man
  install -Dm644 contrib/_${pkgname} -t ${pkgdir}/usr/share/zsh/site-functions/
  install -Dm644 contrib/${pkgname}-completion.bash ${pkgdir}/usr/share/bash-completion/completions/${pkgname}
}
