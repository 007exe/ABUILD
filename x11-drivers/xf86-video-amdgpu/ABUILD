pkgname=xf86-video-amdgpu
pkgver=21.0.0
pkgbuild=1
arch=("auto")

shortdesc=("X.org amdgpu video driver")
longdesc=("The Xorg AMDGPU Driver package contains the X.Org Video Driver for newer AMD Radeon video cards starting from Volcanic Islands. It can also be used for Southern and Sea Islands if the experimental support was enabled in the kernel.")

tags=('x11-drivers xserver')

build_deps="mesa xorg-server-devel"

source=("http://xorg.freedesktop.org/archive/individual/driver/xf86-video-amdgpu-${pkgver}.tar.gz")

build() {
  go_src_dir
  burn_patches

  export CFLAGS=${CFLAGS/-fno-plt}
  export CXXFLAGS=${CXXFLAGS/-fno-plt}
  export LDFLAGS=${LDFLAGS/,-z,now}

  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --enable-glamor
  make -j${numjobs}
  make DESTDIR=${pkgdir} install

  install -m755 -d "${pkgdir}/usr/share/licenses/${pkgname}"
  install -m644 COPYING "${pkgdir}/usr/share/licenses/${pkgname}/"
}
