pkgname=gtk3
pkgver=3.24.30
pkgbuild=1
arch=('auto')

shortdesc=("GObject-based multi-platform GUI toolkit")
longdesc=("The gtk+ package contains the GIMP ToolKit (GTK+), a library for creating graphical user interfaces for the X Window System.  GTK+ was originally written for the GIMP (GNU Image Manipulation Program) image processing program, but is now used by several other programs as well.")

source=("http://ftp.gnome.org/pub/gnome/sources/gtk+/${pkgver%.*}/gtk+-${pkgver}.tar.xz")

tags="libs x11-libs"

build_deps=("atk cairo libxcursor libxinerama libxrandr libxi libepoxy gdk-pixbuf libxcomposite libxdamage pango shared-mime-info wayland libxkbcommon at-spi2-atk librsvg colord desktop-file-utils mesa libcups fribidi gtk-update-icon-cache gobject-introspection gtk-doc git glib2 meson wayland-protocols cantarell-fonts sassc libcloudproviders")

# rest tracker3
adddep="gtk-update-icon-cache adwaita-icon-theme mesa shared-mime-info desktop-file-utils librsvg cantarell-fonts iso-codes dconf json-glib libcanberra libcloudproviders"

pkglist="gtk_update_icon_cache gtk3-docs"

build() {
  go_src_dir
  burn_patches
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --sysconfdir=/etc \
    --enable-broadway-backend \
    --enable-x11-backend \
    --enable-wayland-backend \
    --disable-static
  make -j${numjobs}
  make DESTDIR=${pkgdir} install
  mkdir -p $pkgdir/usr/share/gtk-3.0

  cp ${filedir}/settings.ini $pkgdir/usr/share/gtk-3.0/settings.ini

  rm "$pkgdir/usr/bin/gtk-update-icon-cache"
}

gtk_update_icon_cache() {
    pkgname=gtk-update-icon-cache
    shortdesc=("GTK icon cache update tool")
    longdesc=("GTK icon cache updater")
}

gtk_update_icon_cache_prep() {
  go_src_dir
  cd gtk
  install -D -m755 gtk-update-icon-cache $pkgdir/usr/bin/gtk-update-icon-cache
}

gtk3-docs() {
    pkgname=gtk3-docs
    shortdesc=("GObject-based multi-platform GUI toolkit documentation")
    longdesc=("GObject-based multi-platform GUI toolkit documentationr")
}

gtk3-docs_prep(){
  go_src_dir
  install -d "$pkgdir"/usr/share/doc
  mv ${p_pkgdir}/usr/share/gtk-doc "$pkgdir"/usr/share/
}

gtk3-demos() {
    pkgname=gtk3-demos
    shortdesc=("GObject-based multi-platform GUI toolkit demo applications")
    longdesc=("GObject-based multi-platform GUI toolkit demo applications")
}

gtk3-demos_prep(){
  go_src_dir
  install -d "$pkgdir"/usr/{bin,share/applications,share/glib-2.0/schemas,share/icons/hicolor,share/man/man1}
  mv ${p_pkgdir}/usr/bin/gtk3-{demo,demo-application,icon-browser,widget-factory} "$pkgdir"/usr/bin
  mv ${p_pkgdir}/usr/share/application "$pkgdir"/usr/share
  mv ${p_pkgdir}/usr/share/man/man1/gtk3-{demo,demo-application,icon-browser,widget-factory}.1 "$pkgdir"/usr/share/man/man1
}
