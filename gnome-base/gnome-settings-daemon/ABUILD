pkgname=gnome-settings-daemon
pkgver=42.2
# NOTE: Коммит версии 42.2
_commit=4bdf8b5ae38a382be4126bbc0ce8d87bac46177e
pkgbuild=1
arch=("auto")

shortdesc=("GNOME Settings Daemon.")
longdesc=("Gnome Settings Daemon.")

strict_version='yes'
source=("git:https://gitlab.gnome.org/GNOME/gnome-settings-daemon.git"
"git:https://gitlab.gnome.org/GNOME/libgnome-volume-control.git")

tags=("gnome gnome-base")

#usbguard libcanberra-pulse libnm
build_deps=("libxslt docbook-xsl python git meson dconf gnome-desktop gsettings-desktop-schemas libgweather-4
libnotify libwacom pulseaudio pulseaudio-alsa upower librsvg geoclue nss libgudev gtk3 gcr geocode-glib")

adddep=("gnome-desktop gsettings-desktop-schemas")

config_files=("etc/xdg/Xwayland-session.d/00-xrdb")

before_build() {
  cd ${srcdir}/gnome-settings-daemon_git_gnome-settings-daemon.git.src
  git checkout ${_commit}
  git submodule init
  git submodule set-url subprojects/gvc ${srcdir}/gnome-settings-daemon_git_libgnome-volume-control.git.src
  git submodule update
}

build() {
  cd ${srcdir}/gnome-settings-daemon_git_gnome-settings-daemon.git.src
  meson build \
    -D prefix=/usr \
    -D libdir=/usr/lib \
    -D systemd=false
  meson compile -C build
  meson install -C build --destdir ${pkgdir}
}
