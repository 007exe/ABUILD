From 808523294e6b0e158fa3e0ecb769ff22c5d5c5f2 Mon Sep 17 00:00:00 2001
From: Vollstrecker <werner@vollstreckernet.de>
Date: Sun, 25 Apr 2021 12:55:31 +0200
Subject: [PATCH] Don't yell commands #3 Fix install location of translations

---
 po/CMakeLists.txt | 120 ++++++++++++++++++++++++----------------------
 1 file changed, 62 insertions(+), 58 deletions(-)

diff --git a/po/CMakeLists.txt b/po/CMakeLists.txt
index 136f5b8b0..412fb284b 100644
--- a/po/CMakeLists.txt
+++ b/po/CMakeLists.txt
@@ -1,67 +1,71 @@
-FILE (GLOB PO_FILES RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "*.po")
+file (GLOB PO_FILES RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "*.po")
+include (CMakeDependentOption)
 
-INCLUDE (CMakeDependentOption)
+function (SetTranslationOption PoName DefaultMode)
+	set (LangName "${PoName}")
+	string (REGEX REPLACE "^ar$"	"Arabic"		LangName "${LangName}")
+	string (REGEX REPLACE "^ast$"	"Asturian"		LangName "${LangName}")
+	string (REGEX REPLACE "^bg$"	"Bulgarian"		LangName "${LangName}")
+	string (REGEX REPLACE "^ca$"	"Catalan"		LangName "${LangName}")
+	string (REGEX REPLACE "^cs$"	"Czech"			LangName "${LangName}")
+	string (REGEX REPLACE "^da$"	"Danish"		LangName "${LangName}")
+	string (REGEX REPLACE "^de$"	"German"		LangName "${LangName}")
+	string (REGEX REPLACE "^el$"	"Greek"			LangName "${LangName}")
+	string (REGEX REPLACE "^en_GB$"	"English"		LangName "${LangName}")
+	string (REGEX REPLACE "^es$"	"Spanish"		LangName "${LangName}")
+	string (REGEX REPLACE "^et_EE$"	"Estonian"		LangName "${LangName}")
+	string (REGEX REPLACE "^eu$"	"Basque"		LangName "${LangName}")
+	string (REGEX REPLACE "^fi$"	"Finnish"		LangName "${LangName}")
+	string (REGEX REPLACE "^fr$"	"French"		LangName "${LangName}")
+	string (REGEX REPLACE "^gl$"	"Galician"		LangName "${LangName}")
+	string (REGEX REPLACE "^he$"	"Hebrew"		LangName "${LangName}")
+	string (REGEX REPLACE "^hr$"	"Croatian"		LangName "${LangName}")
+	string (REGEX REPLACE "^hu$"	"Hungarian"		LangName "${LangName}")
+	string (REGEX REPLACE "^it$"	"Italian"		LangName "${LangName}")
+	string (REGEX REPLACE "^it_CH$"	"Italian (Swiss)"	LangName "${LangName}")
+	string (REGEX REPLACE "^ja$"	"Japanese"		LangName "${LangName}")
+	string (REGEX REPLACE "^ko_KR$"	"Korean"		LangName "${LangName}")
+	string (REGEX REPLACE "^lt$"	"Lithuanian"		LangName "${LangName}")
+	string (REGEX REPLACE "^nl$"	"Dutch"			LangName "${LangName}")
+	string (REGEX REPLACE "^nn$"	"Norwegian (Nynorsk)"	LangName "${LangName}")
+	string (REGEX REPLACE "^pl$"	"Polish"		LangName "${LangName}")
+	string (REGEX REPLACE "^pt_BR$"	"Portuguese (Brazilian)" LangName "${LangName}")
+	string (REGEX REPLACE "^pt_PT$"	"Portuguese"		LangName "${LangName}")
+	string (REGEX REPLACE "^ro$"	"Romanian"		LangName "${LangName}")
+	string (REGEX REPLACE "^ru$"	"Russian"		LangName "${LangName}")
+	string (REGEX REPLACE "^sl$"	"Slovenian"		LangName "${LangName}")
+	string (REGEX REPLACE "^sq$"	"Albanian"		LangName "${LangName}")
+	string (REGEX REPLACE "^sv$"	"Swedish"		LangName "${LangName}")
+	string (REGEX REPLACE "^tr$"	"Turkish"		LangName "${LangName}")
+	string (REGEX REPLACE "^uk$"	"Ukrainian"		LangName "${LangName}")
+	string (REGEX REPLACE "^zh_CN$"	"Chinese (Simplified)"	LangName "${LangName}")
+	string (REGEX REPLACE "^zh_TW$"	"Chinese (Traditional)"	LangName "${LangName}")
+	cmake_dependent_option (TRANSLATION_${PoName} "Build ${LangName} translation" ${DefaultMode} ENABLE_NLS OFF)
+endfunction()
 
-FUNCTION (SetTranslationOption PoName DefaultMode)
-	SET (LangName "${PoName}")
-	STRING (REGEX REPLACE "^ar$"	"Arabic"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^ast$"	"Asturian"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^bg$"	"Bulgarian"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^ca$"	"Catalan"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^cs$"	"Czech"			LangName "${LangName}")
-	STRING (REGEX REPLACE "^da$"	"Danish"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^de$"	"German"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^el$"	"Greek"			LangName "${LangName}")
-	STRING (REGEX REPLACE "^en_GB$"	"English"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^es$"	"Spanish"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^et_EE$"	"Estonian"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^eu$"	"Basque"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^fi$"	"Finnish"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^fr$"	"French"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^gl$"	"Galician"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^he$"	"Hebrew"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^hr$"	"Croatian"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^hu$"	"Hungarian"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^it$"	"Italian"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^it_CH$"	"Italian (Swiss)"	LangName "${LangName}")
-	STRING (REGEX REPLACE "^ja$"	"Japanese"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^ko_KR$"	"Korean"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^lt$"	"Lithuanian"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^nl$"	"Dutch"			LangName "${LangName}")
-	STRING (REGEX REPLACE "^nn$"	"Norwegian (Nynorsk)"	LangName "${LangName}")
-	STRING (REGEX REPLACE "^pl$"	"Polish"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^pt_BR$"	"Portuguese (Brazilian)" LangName "${LangName}")
-	STRING (REGEX REPLACE "^pt_PT$"	"Portuguese"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^ro$"	"Romanian"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^ru$"	"Russian"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^sl$"	"Slovenian"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^sq$"	"Albanian"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^sv$"	"Swedish"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^tr$"	"Turkish"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^uk$"	"Ukrainian"		LangName "${LangName}")
-	STRING (REGEX REPLACE "^zh_CN$"	"Chinese (Simplified)"	LangName "${LangName}")
-	STRING (REGEX REPLACE "^zh_TW$"	"Chinese (Traditional)"	LangName "${LangName}")
-	CMAKE_DEPENDENT_OPTION (TRANSLATION_${PoName} "Build ${LangName} translation" ${DefaultMode} ENABLE_NLS OFF)
-ENDFUNCTION (SetTranslationOption)
+foreach (PO_FILE ${PO_FILES})
+	string (REGEX REPLACE ".po" "" PO_FILE ${PO_FILE})
 
-FOREACH (PO_FILE ${PO_FILES})
-	STRING (REGEX REPLACE ".po" "" PO_FILE ${PO_FILE})
+	if (TRANSLATIONS)
+		string (REGEX MATCH "${PO_FILE}," TRANS "${TRANSLATIONS}")
 
-	IF (TRANSLATIONS)
-		STRING (REGEX MATCH "${PO_FILE}," TRANS "${TRANSLATIONS}")
-
-		IF (TRANS)
+		if (TRANS)
 			SetTranslationOption ("${PO_FILE}" ON)
-		ELSE (TRANS)
+		else()
 			SetTranslationOption ("${PO_FILE}" OFF)
-		ENDIF (TRANS)
-	ELSE (TRANSLATIONS)
+		endif()
+	else()
 		SetTranslationOption ("${PO_FILE}" ON)
-	ENDIF (TRANSLATIONS)
+	endif()
+
+	if (TRANSLATION_${PO_FILE})
+		list (APPEND PO_BUILD ${PO_FILE}.po)
 
-	IF (TRANSLATION_${PO_FILE})
-		LIST (APPEND PO_BUILD ${PO_FILE}.po)
-	ENDIF (TRANSLATION_${PO_FILE})
-ENDFOREACH (PO_FILE ${PO_FILES})
+		install (FILES ${CMAKE_CURRENT_BINARY_DIR}/${PO_FILE}.gmo
+			DESTINATION ${CMAKE_INSTALL_LOCALEDIR}/${PO_FILE}/LC_MESSAGES/
+			RENAME ${PO_FILE}.mo
+		)
+	endif()
+endforeach()
 
-GETTEXT_PROCESS_PO_FILES ("" ALL INSTALL_DESTINATION ${LOCALEDIR} PO_FILES ${PO_BUILD})
+gettext_process_po_files ("" ALL INSTALL_DESTINATION ${CMAKE_INSTALL_LOCALEDIR} PO_FILES ${PO_BUILD})
