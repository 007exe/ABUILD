pkgname=ipython
pkgver=8.4.0
pkgbuild=1
arch=("auto")

shortdesc=("An enhanced Interactive Python shell.")
longdesc=("IPython provides a rich architecture for interactive computing.")

source=("http://archive.ipython.org/release/$pkgver/ipython-$pkgver.tar.gz"
"https://www.packal.org/sites/default/files/public/styles/icon_large/public/workflow-files/nkeimipynbworkflow/icon/icon.png")

tags=("develop dev-python")

# python-traitlets python-pickleshare python-prompt_toolkit python-jedi python-backcall python-matplotlib-inline python-stack-data
build_deps=("python-build python-installer python-setuptools python-wheel
python-pexpect sqlite python-pygments")

# python-traitlets python-pickleshare python-prompt_toolkit python-jedi python-backcall python-matplotlib-inline python-stack-data
adddep=("python-pexpect sqlite python-pygments")

build() {
  go_src_dir
  burn_patches
  python -m build --wheel --skip-dependency-check --no-isolation
  python -m installer --destdir=${pkgdir} dist/*.whl
  cd "examples/IPython Kernel"
  sed -i 's/gnome-netstatus-idle/ipython/' ipython.desktop
  install -Dm644 -t ${pkgdir}/usr/share/applications ipython.desktop
  install -Dm644 ${srcache}/icon.png ${pkgdir}/usr/share/pixmaps/ipython.png
  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
  install -d ${pkgdir}/usr/share/licenses/${pkgname}
  ln -s "$site_packages"/${pkgname}-${pkgver}.dist-info/LICENSE ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
}
