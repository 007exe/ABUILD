# NOTE: Иногда при обновлении следует удалить python-setuptools
pkgname=python-setuptools
pkgver=64.0.0
pkgbuild=1
arch=("auto")

shortdesc=("Easily build and distribute Python packages.")
longdesc=("Download, build, install, upgrade, and uninstall Python packages -- easily! Homepage: http://pypi.python.org/pypi/setuptools")

source=("https://files.pythonhosted.org/packages/source/s/setuptools/setuptools-${pkgver}.tar.gz")

tags=("dev-python libs")

#python-setuptools
build_deps=("python python-appdirs python-jaraco.text python-more-itertools
python-nspektr python-ordered-set python-packaging python-pyparsing python-tomli python-validate-pyproject")

adddep=("python-appdirs python-jaraco.text python-more-itertools python-nspektr python-ordered-set
python-packaging python-pyparsing python-tomli python-validate-pyproject")

before_build(){
  go_src_dir
  burn_patches
  rm -r */_vendor
  rm -r */extern
  find -name '*.py' -exec sed \
       -e 's:from \w*[.]\+extern ::' -e 's:\w*[.]\+extern[.]::' \
       -i {} + || die
}

build() {
  go_src_dir
#  export SETUPTOOLS_INSTALL_WINDOWS_SPECIFIC_FILES=0
  export SETUPTOOLS_SCM_PRETEND_VERSION=${pkgver}
  SETUPTOOLS_USE_DISTUTILS=stdlib
  python setup.py build
  python setup.py install --prefix=/usr --root=${pkgdir} --optimize=1 --skip-build
}
