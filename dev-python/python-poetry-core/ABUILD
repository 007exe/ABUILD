pkgname=python-poetry-core
pkgver=1.0.8
pkgbuild=1
arch=("auto")

shortdesc=("Poetry PEP 517 Build Backend.")
longdesc=("Poetry PEP 517 Build Backend & Core Utilities.")

_pkgname=poetry-core
source=("https://github.com/python-poetry/${_pkgname}/archive/${pkgver}.tar.gz")

tags=("libs dev-python")

build_deps=("python python-dephell python-jsonschema python-lark-parser python-packaging python-tomlkit")

adddep=("python-jsonschema python-lark-parser python-packaging python-tomlkit")

build() {
  go_src_dir
# remove vendored dependencies
  rm -r poetry/core/_vendor
  sed -i '/^__version__/!d' poetry/core/__init__.py
# be a proper namespace, python3-only ;)
  rm poetry/__init__.py
  dephell deps convert --from pyproject.toml --to setup.py
  python setup.py build
  python setup.py install --root="${pkgdir}" --optimize=1 --skip-build
  install -Dm644 LICENSE "${pkgdir}"/usr/share/licenses/${pkgname}/LICENSE
}
