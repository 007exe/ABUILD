pkgname=python-pip
pkgver=22.2.2
pkgbuild=1
arch=("auto")

shortdesc=("The PyPA recommended tool for installing Python packages")
longdesc=("Pip is a tool for installing and managing Python packages, such as those found in the Python Package Index_. It's a replacement for easy_install_.")

source=("https://github.com/pypa/pip/archive/refs/tags/${pkgver}.tar.gz")

tags=("develop dev-python")

build_deps=("python python-setuptools python-appdirs python-colorama python-html5lib python-packaging
python-requests python-setuptools python-six python-toml python-cachecontrol python-distlib python-distro
python-pep517 python-progress python-retrying python-resolvelib python-pyopenssl python-contextlib2")

adddep=("python-appdirs python-colorama python-html5lib python-packaging python-requests python-setuptools
python-six python-toml python-cachecontrol python-distlib python-distro python-pep517 python-progress
python-retrying python-resolvelib python-pyopenssl python-contextlib2")

build(){
  go_src_dir
  burn_patches
# Удаляем файлы, предоставленные поставщиком, за исключением __init__.py
  rm -frv "src/pip/_vendor/!(__init__.py)"
  shopt -u extglob
  python -m build --wheel --no-isolation
#  cd docs/
#  PYTHONPATH=../src/ python pip_sphinxext.py
#  PYTHONPATH=../src/ sphinx-build -b man -d build/doctrees/man man build/man -c html
#  cd ..
  local _site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
  python -m installer --destdir=${pkgdir} dist/*.whl
  install -D -m644 LICENSE.txt ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
#  install -vDm 644 docs/build/man/*.1 -t ${pkgdir}/usr/share/man/man1/
  install -vDm 644 {NEWS,README}.rst -t ${pkgdir}/usr/share/doc/${pkgname}/

  PYTHONPATH=${pkgdir}/${_site_packages} ${pkgdir}/usr/bin/pip completion --bash | install -vDm 644 /dev/stdin ${pkgdir}/usr/share/bash-completion/completions/pip
  PYTHONPATH=${pkgdir}/${_site_packages} ${pkgdir}/usr/bin/pip completion --fish | install -vDm 644 /dev/stdin ${pkgdir}/usr/share/fish/vendor_completions.d/pip.fish
}
