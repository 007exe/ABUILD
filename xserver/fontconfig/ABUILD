pkgname=fontconfig
pkgver=2.13.94
pkgbuild=1
arch=("auto")

shortdesc=("Font configuration library")
longdesc=("Fontconfig is designed to locate fonts within the system and select them according to requirements specified by applications.")

tags=("xserver x11-utils")

source=("http://www.fontconfig.org/release/$pkgname-$pkgver.tar.gz")
# docbook-utils docbook-sgml
build_deps="expat freetype meson gperf perl-sgmls"

config_files="etc/fonts/fonts.conf"

build() {
  meson fontconfig-$pkgver build \
    -Dprefix=/usr \
    -D doc-txt=disabled \
    -D doc-pdf=disabled \
    -D doc-html=disabled
  meson compile -C build
  meson install -C build --destdir "$pkgdir"

# Handle conf.d using the hook to avoid overwriting the symlinks on upgrade
  mkdir -p "$pkgdir/usr/share/fontconfig/conf.default"
  for _f in "$pkgdir"/etc/fonts/conf.d/*.conf; do
    ln -sr "$pkgdir"/usr/share/fontconfig/conf.{avail,default}/"${_f##*/}"
    rm "$_f"
  done

  install -Dt "$pkgdir/usr/share/licenses/$pkgname" -m644 fontconfig-$pkgver/COPYING
}
