pkgname=ngspice
pkgver=35
pkgbuild=1
arch=('auto')

shortdesc=("Mixed-level/Mixed-signal circuit simulator based on Spice3f5, Ciber1b1, and Xspice.")
longdesc=("KiKit is a Python library, KiCAD plugin and a CLI tool to automate several tasks in a standard KiCAD workflow.")

source=("https://downloads.sourceforge.net/project/ngspice/ng-spice-rework/$pkgver/ngspice-$pkgver.tar.gz"
"http://ngspice.sourceforge.net/docs/ngspice-$pkgver-manual.pdf")

tags="develop dev-scheme"

build_deps="libxaw libedit gcc-libs"

build() {
  go_src_dir
  burn_patches
# FS#45230, create so lib
# shared lib sets flags and modifies headers, needs dedicated pass
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --mandir=/usr/share/man \
    --infodir=/usr/share/info \
    --with-readline=no \
    --enable-xspice \
    --enable-cider \
    --enable-openmp \
    --enable-oldapps \
    --with-ngshared
  make -j${numjobs}

#strip ./src/.libs/libngspice.so.0.0.0
  ./configure \
    --prefix=/usr \
    --libdir=/usr/lib${LIBDIRSUFFIX} \
    --mandir=/usr/share/man \
    --infodir=/usr/share/info \
    --with-readline=no \
    --enable-xspice \
    --enable-cider \
    --enable-oldapps \
    --enable-openmp
  make -j${numjobs}
  make DESTDIR="$pkgdir" install

  install -D -m644 COPYING "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
  install -D -m644  ${srcache}/ngspice-$pkgver-manual.pdf "$pkgdir/usr/share/doc/$pkgname/manual.pdf"

  install -Dm755 src/.libs/libngspice.so.0.0.1 "$pkgdir/usr/lib${LIBDIRSUFFIX}/libngspice.so.0.0.1"
  ln -s "libngspice.so.0.0.1" "$pkgdir/usr/lib${LIBDIRSUFFIX}/libngspice.so.0"
  ln -s "libngspice.so.0.0.1" "$pkgdir/usr/lib${LIBDIRSUFFIX}/libngspice.so"

# FS#70563, probably remove on v35
  install -Dm644 ngspice.pc "$pkgdir/usr/lib${LIBDIRSUFFIX}/pkgconfig/ngspice.pc"
  install -Dm644 src/include/ngspice/sharedspice.h "$pkgdir/usr/include/ngspice/sharedspice.h"
}
