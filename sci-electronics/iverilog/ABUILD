pkgname=iverilog
pkgver=12.0
pkgbuild=1
arch=("auto")

shortdesc=("Icarus Verilog compiler and simulation tool.")

source=("https://github.com/steveicarus/iverilog/archive/refs/tags/v${pkgver//./_}.tar.gz")

tags=("sci-electronics utils")

adddep=("zlib bzip2")

build_deps=("${adddep} gperf")

# NOTE: Удаляем исходники пакета после сборки
# FIXME: mkpkg не умеет сохранять скачанные файлы под новыми именами, что может приводить к
# ошибкам когда в кеше имеется архив с исходниками от другого пакета с тем же именем
before_build(){
  go_src_dir
  rm -f ${srcache}/v${pkgver//./_}.tar.gz
}

build() {
  go_src_dir
  burn_patches
  aclocal
  autoconf
  CFLAGS+=' -ffat-lto-objects -fcommon'
  CXXCPP=/usr/bin/cpp ./configure --prefix=/usr
  make -j1
  make -j1 DESTDIR=${pkgdir} install
}
